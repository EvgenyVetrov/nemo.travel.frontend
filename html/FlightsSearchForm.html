<!-- nemo-flights-form_compact || nemo-flights-form_twoThirds -->
<div class="nemo-flights-form js-autofocus-form js-nemoApp__component"> <!-- MODIFIERS: nemo-flights-form_compact || nemo-flights-form_twoThirds -->
<!-- ko if: !$$loading() && !$$error() -->
	<div class="nemo-flights-form__routeTypeSelector nemo-flights-form__routeTypeSelector_buttons" data-bind="foreach: tripTypes"><!--
		--><div
			class="new-ui-button new-ui-button_common nemo-flights-form__routeTypeSelector__button"
			data-bind="
				text: $root.i18n('FlightsSearchForm','triptype_'+$data),
				css: {'nemo-flights-form__routeTypeSelector__button_active': $parent.tripType() == $data},
				click: function () {$parent.tripType($data);$parent.typeSelectorOpen(false);}"></div><!--
	--></div>

	<!-- TODO dropdown -->
	<div class="nemo-flights-form__routeTypeSelector nemo-flights-form__routeTypeSelector_select">
		<div class="nemo-flights-form__routeTypeSelector__selectWrap">
			<select data-bind="
					simpleSelect: {
						data: tripTypes,
						containerCssClass: 'new-ui-button new-ui-button_common new-ui-button_small nemo-flights-form__routeTypeSelector__select',
						i18nSegment: 'FlightsSearchForm',
						i18nPrefix: 'triptype_'
					},
					value: tripType
				"></select>
		</div>
	</div>

	<div class="nemo-flights-form__formContainer">
		<div class="nemo-flights-form__formContainer__inner">
			<div data-bind="attr: {'class':'nemo-flights-form__route nemo-flights-form__route_'+tripType()}, foreach: segments(), flightsFormAutoFocus: null"><div
					data-bind="
						attr: {'class':'nemo-flights-form__route__segment'+($parent.tripType() == 'RT' && $index() == 1 ? ' nemo-flights-form__route__segment_returnSegment' : '') + ' nemo-flights-form__route__segment_'+$parent.tripType() + ' js-autofocus-segment'}
						">
					<!-- ko if: $parent.tripType() != 'RT' || $index() != 1 -->
					<div class="nemo-flights-form__route__segment__item nemo-flights-form__route__segment__item_from"
					     data-bind="css: {'nemo-flights-form__route__segment__item_hasError': $parent.validaTERROR() && items.departure.error()}">
						<!-- ko if: $parent.tripType() == 'CR' && $index() == ($parent.segments().length-1) -->
						<div class="nemo-flights-form__route__removeCRSegment" data-bind="click: $parent.removeLastCRSegment.bind($parent), css: {'nemo-flights-form__route__removeCRSegment_inactive': $parent.segments().length == 1}"></div>
						<!-- /ko -->
						<label class="new-ui-textInput new-ui-dummiedInput js-autocomplete">
							<!-- ko if: $parent.validaTERROR() && items.departure.error() && items.departure.focus() -->
							<div
									class="new-ui-hint nemo-flights-form__route__segment__item__error"
									data-bind="text: $root.i18n('FlightsSearchForm','error_departure_'+items.departure.error());"></div>
							<!-- /ko -->
							<div class="nemo-flights-form__route__segment__item__inputContainer">
								<input
										class="
											new-ui-textInput__input
											new-ui-dummiedInput__input
											nemo-flights-form__route__segment__input
											nemo-flights-form__route__segment__input_autocomplete
											js-autofocus-field
											js-autofocus-field_departure"
										type="text"
										placeholder="Откуда (город или аэропорт)"
										data-bind="flightsFormGeoAC: items.departure.value, hasFocus: items.departure.focus">
								<div class="new-ui-dummiedInput__dummy nemo-flights-form__route__segment__item__dummy js-autocomplete-dummy">
									<!-- ko if: !items.departure.value() -->
									<span class="new-ui-dummiedInput__dummy__placeholder js-autocomplete-dummy__placeholder">
										Откуда (город или аэропорт)
									</span>
									<!-- /ko -->
									<!-- ko if: items.departure.value() -->
										<!-- ko with: items.departure.value() -->
											<span class="new-ui-dummiedInput__dummy__main js-autocomplete-dummy__main" data-bind="text: name"></span><!--
											--><span class="new-ui-dummiedInput__dummy__aux js-autocomplete-dummy__aux" data-bind="text: ', ' + (!isCity && city && name != city.name ? city.name + ', ' : '') + country.name"></span>
										<!-- /ko -->
									<!-- /ko -->
								</div>
							</div>
						</label>
					</div><div class="nemo-flights-form__route__segment__item nemo-flights-form__route__segment__item_to"
							data-bind="css: {'nemo-flights-form__route__segment__item_hasError': $parent.validaTERROR() && items.arrival.error()}">
						<label class="new-ui-textInput new-ui-dummiedInput js-autocomplete">
							<!-- ko if: $parent.validaTERROR() && items.arrival.error() && items.arrival.focus() -->
							<div
									class="new-ui-hint nemo-flights-form__route__segment__item__error"
									data-bind="text: $root.i18n('FlightsSearchForm','error_arrival_'+items.arrival.error());"></div>
							<!-- /ko -->
							<div class="nemo-flights-form__route__segment__item__inputContainer">
								<input class="
											new-ui-textInput__input
											new-ui-dummiedInput__input
											nemo-flights-form__route__segment__input
											nemo-flights-form__route__segment__input_autocomplete
											js-autofocus-field
											js-autofocus-field_arrival"
								       type="text"
								       placeholder="Куда (город или аэропорт)"
								       data-bind="flightsFormGeoAC: items.arrival.value, hasFocus: items.arrival.focus">
								<div class="new-ui-dummiedInput__dummy nemo-flights-form__route__segment__item__dummy js-autocomplete-dummy">
									<!-- ko if: !items.arrival.value() -->
									<span class="new-ui-dummiedInput__dummy__placeholder js-autocomplete-dummy__placeholder">
										Куда (город или аэропорт)
									</span>
									<!-- /ko -->
									<!-- ko if: items.arrival.value() -->
										<!-- ko with: items.arrival.value() -->
											<span class="new-ui-dummiedInput__dummy__main js-autocomplete-dummy__main" data-bind="text: name"></span><!--
											--><span class="new-ui-dummiedInput__dummy__aux js-autocomplete-dummy__aux" data-bind="text: ', ' + (!isCity && city && name != city.name ? city.name + ', ' : '') + country.name"></span>
										<!-- /ko -->
									<!-- /ko -->
								</div>
							</div>
						</label>
					</div><!--
					/ko
					--><div class="nemo-flights-form__route__segment__item nemo-flights-form__route__segment__item_date"
					        data-bind="css: {'nemo-flights-form__route__segment__item_hasError': $parent.validaTERROR() && items.departureDate.error()}">
						<label class="new-ui-textInput new-ui-dummiedInput nemo-flights-form__route__segment__item__date">
							<div class="nemo-flights-form__route__segment__item__date__indicator" data-bind="text: items.departureDate.value() ? items.departureDate.value().getDate() : 31"></div>
							<!-- ko if: $parent.validaTERROR() && items.departureDate.error() && items.departureDate.focus() -->
							<div
								class="new-ui-hint nemo-flights-form__route__segment__item__error"
								data-bind="text: $root.i18n('FlightsSearchForm','error_departureDate_'+items.departureDate.error());"></div>
							<!-- /ko -->
							<div class="nemo-flights-form__route__segment__item__inputContainer">
								<input
										class="
											new-ui-textInput__input
											new-ui-dummiedInput__input
											nemo-flights-form__route__segment__input
											nemo-flights-form__route__segment__input_date
											js-autofocus-field
											js-autofocus-field_date"
										type="text"
										data-bind="
											attr: {placeholder: $parent.tripType() == 'RT' ? ($index() == 0 ? 'Туда' : 'Назад') : 'Когда'},
											flightsFormDatepicker: items.departureDate.value,
											hasFocus: items.departureDate.focus">
								<div class="new-ui-dummiedInput__dummy nemo-flights-form__route__segment__item__dummy nemo-flights-form__route__segment__item__date__dummy nemo-flights-form__route__segment__item__date__dummy_full">
									<!-- ko if: !items.departureDate.value() -->
									<span class="new-ui-dummiedInput__dummy__placeholder" data-bind="text: $parent.tripType() == 'RT' ? ($index() == 0 ? 'Туда' : 'Назад') : 'Когда'"></span>
									<!-- /ko -->
									<!-- ko if: items.departureDate.value() -->
									<span class="new-ui-dummiedInput__dummy__main" data-bind="text: items.departureDate.value().getDate()+' '+items.departureDate.value().getMonthName()"></span><span class="new-ui-dummiedInput__dummy__aux" data-bind="text: ', '+items.departureDate.value().getDOWName()"></span>
									<!-- /ko -->
								</div>
								<div class="new-ui-dummiedInput__dummy nemo-flights-form__route__segment__item__dummy nemo-flights-form__route__segment__item__date__dummy nemo-flights-form__route__segment__item__date__dummy_short">
									<!-- ko if: !items.departureDate.value() -->
									<span class="new-ui-dummiedInput__dummy__placeholder" data-bind="text: $parent.tripType() == 'RT' ? ($index() == 0 ? 'Туда' : 'Назад') : 'Когда'"></span>
									<!-- /ko -->
									<!-- ko if: items.departureDate.value() -->
									<span class="new-ui-dummiedInput__dummy__main" data-bind="text: items.departureDate.value().getDate()+' '+items.departureDate.value().getMonthNameShort()"></span><span class="new-ui-dummiedInput__dummy__aux" data-bind="text: ', '+items.departureDate.value().getDOWNameShort()"></span>
									<!-- /ko -->
								</div>
							</div>
						</label>
						<!-- ko if: $parent.tripType() == 'RT' && $index() == 1 -->
						<div class="nemo-flights-form__route__switchToOW" data-bind="click: function () {$parent.tripType('OW')}"></div>
						<!-- /ko -->
					</div>
				</div><!-- ko if: $parent.tripType() == 'OW' --><div class="nemo-flights-form__route__segment nemo-flights-form__route__segment_returnSegment">
					<div class="nemo-flights-form__route__segment__item nemo-flights-form__route__segment__item_date">
						<div class="nemo-flights-form__route__switchToRT" data-bind="click: function () {$parent.tripType('RT')}">
							И обратно
						</div>
					</div>
				</div><!-- /ko --><!-- ko if: $parent.tripType() == 'CR' && $index() == ($parent.segments().length-1) -->
				<div class="nemo-flights-form__route__continueCR" data-bind="click: $parent.continueCR.bind($parent), css: {'nemo-flights-form__route__continueCR_inactive': $parent.segments().length >= $parent.options.flightSegments}">
					Продолжить маршрут
				</div>
				<!-- /ko --><!--
			--></div>
			<div class="nemo-flights-form__passengers">
				<!-- ko if: validaTERROR() && passengersError() -->
				<div data-bind="text: $root.i18n('FlightsSearchForm','error_passengers_'+passengersError());" class="new-ui-hint nemo-flights-form__passengers__error"></div>
				<!-- /ko -->
				<div class="nemo-flights-form__passengers__container" data-bind="click: openPassengersSelector, text: passengersSummary"></div>

				<div class="new-ui-button new-ui-button_common new-ui-button_small new-ui-button_direction_down nemo-flights-form__passengers__containerColumn" data-bind="click: openPassengersSelector, text: passengersSummary"></div>

				<div class="nemo-flights-form__passengers__fastSelect" data-bind="visible: passengersFastSelectorOpen">
					<!-- ko foreach: passengersFastSelectOptions -->
					<div class="nemo-flights-form__passengers__fastSelect__item"
					     data-bind="
							        text: $parent.passengersTextForFastSelect($index()),
							        click: function () {$parent.passengersFastSelectorOpen(false); $parent.passengersSelectFast($index());}
						         "></div>
					<!-- /ko -->
					<!-- ko if: passengersUseExtendedSelect -->
					<div class="nemo-flights-form__passengers__fastSelect__item" data-bind="
						popup: {
							block: 'passengersFullSelect',
							title: 'Пассажиры',
							buttons: [
								{
									text: 'Готово',
									click: function () {$(this).data('ui-popup__close')()}
								}
							]
						},
						click: function () {passengersFastSelectorOpen(false);},
						text: 'Больше пассажиров'
						"></div>
					<!-- /ko -->
				</div>
			</div>
			<div class="nemo-flights-form__buttonContainer">
				<button class="new-ui-button new-ui-button_main nemo-flights-form__searchButton"
						data-bind="
							click: startSearch,
							css: {
								'new-ui-button_disabled': validaTERROR() && !isValid(),
								'nemo-flights-form__searchButton_searching': isSearching()
							}">
					Найти
				</button>
			</div>
			<div  data-bind="attr: {'class':'nemo-flights-form__routeOptions nemo-flights-form__routeOptions_'+tripType()}">
				<div class="nemo-flights-form__routeOptions__inner">
					<div class="nemo-flights-form__routeOptions__item nemo-flights-form__routeOptions__item_routeType">
						<span class="nemo-flights-form__routeOptions__item__caption">
							Маршрут
						</span>
						<div class="nemo-flights-form__routeOptions__item__selector">
							<select data-bind="
								simpleSelect: {
									data: tripTypes,
									containerCssClass: 'new-ui-button new-ui-button_common new-ui-button_small nemo-flights-form__routeOptions__item__selector__button',
									i18nSegment: 'FlightsSearchForm',
									i18nPrefix: 'triptype_'
								},
								value: tripType
							"></select>
						</div>
					</div><!--
					--><div class="nemo-flights-form__routeOptions__item nemo-flights-form__routeOptions__item_class">
						<span class="nemo-flights-form__routeOptions__item__caption">
							Класс
						</span>
						<div class="nemo-flights-form__routeOptions__item__selector">
							<select data-bind="
								simpleSelect: {
									data: serviceClasses,
									containerCssClass: 'new-ui-button new-ui-button_common new-ui-button_small nemo-flights-form__routeOptions__item__selector__button',
									i18nSegment: 'FlightsSearchForm',
									i18nPrefix: 'serviceClass_'
								},
								value: serviceClass
							"></select>
						</div>
					</div><!--
						ko if: tripType() != 'CR' && options.dateOptions.aroundDatesValues.length > 1
					--><div class="nemo-flights-form__routeOptions__item nemo-flights-form__routeOptions__item_multiDate">
						<label class="new-ui-checkbox nemo-flights-form__routeOptions__item__checkbox">
							<input class="new-ui-checkbox__input" type="checkbox" data-bind="checked: vicinityDates">
							<span class="new-ui-checkbox__caption nemo-flights-form__routeOptions__item__checkbox__caption">Искать &plusmn;3 дня</span>
						</label>
					</div>
					<!-- /ko --><div class="nemo-flights-form__routeOptions__item nemo-flights-form__routeOptions__item_direct">
						<label class="new-ui-checkbox nemo-flights-form__routeOptions__item__checkbox">
							<input class="new-ui-checkbox__input" type="checkbox" data-bind="checked: directFlights">
							<span class="new-ui-checkbox__caption nemo-flights-form__routeOptions__item__checkbox__caption">Только прямые</span>
						</label>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div data-block="passengersFullSelect" style="display: none;"
		class="nemo-flights-form__passengersPopUp js-nemoApp__popupBlock"
		data-bind="foreach: {data: passengerTypesOrder, as: 'passType'}"
		>
		<!-- ko if: $parent.options.passengerCount[passType] &&  parseInt($parent.options.passengerCount[passType]) -->
		<div data-bind="attr: {'class': 'nemo-flights-form__passengersPopUp__item nemo-flights-form__passengersPopUp__item_' + passType}">
			<div class="nemo-flights-form__passengersPopUp__item__header" data-bind="text: $root.i18n('FlightsSearchForm','passengerType_'+passType+'_passSelectorName')"></div>
			<div class="nemo-flights-form__passengersPopUp__item__subheader" data-bind="text: $root.i18n('FlightsSearchForm','passengerType_'+passType+'_ageInfo')"></div>
			<div class="nemo-flights-form__passengersPopUp__item__counts" data-bind="foreach: $parent.getPassengersCounts(passType)">
				<div
					data-bind="
						text: $root.i18n('FlightsSearchForm','passengers_count_' + $data),
						attr: {'class':
								'nemo-flights-form__passengersPopUp__item__count nemo-flights-form__passengersPopUp__item__count_' + $data +
								(
									$parents[1].passengers()[passType] && $parents[1].passengers()[passType]() == $data ?
									' nemo-flights-form__passengersPopUp__item__count_active' :
									''
								) +
								(
									$data > $parents[1].passengersRestrictions()[passType].max || $data < $parents[1].passengersRestrictions()[passType].min ?
									' nemo-flights-form__passengersPopUp__item__count_disabled':
									''
								)
							},
						click: function () {$parents[1].setPassengers(passType, parseInt($data));}"
					></div>
			</div>
		</div>
		<!-- /ko -->
	</div>

	<!-- ko if: isSearching () -->
		<div data-bind="
			automaticPopup: {
				title: 'Идет поиск',
				close: function () {abortSearch()},
				closeOnOverlayClick: false,
				dialogClass: 'nemo-flights-form__searchingInfoPopup',
				contentClass: 'nemo-flights-form__searchingInfoPopup__content',
				headerClass: 'ui-dialog-titlebar_progress nemo-flights-form__searchingInfoPopup__header'
			}
		">
			<div class="nemo-flights-form__searchingInfo nemo-flights-form__searchingInfoPopup" style="display: none;">
				<div class="nemo-flights-form__searchingInfo__header">
					Пожалуйста, подождите
				</div>
				<div class="nemo-flights-form__searchingInfo__subHeader">
					Мы ищем
					<!-- ko text: $root.i18n('FlightsSearchForm', 'searchingInfo__flightType_' + tripType()) --><!-- /ko -->
					<!-- ko text: $root.i18n('FlightsSearchForm', 'searchingInfo__class_' + serviceClass()) --><!-- /ko -->
					по маршруту
				</div>
				<div class="nemo-flights-form__searchingInfo__segments" data-bind="css: {'nemo-flights-form__searchingInfo__segments_RTLike': segments().length == 2}, foreach: segments"><!--
					--><div class="nemo-flights-form__searchingInfo__segment">
						<div class="nemo-flights-form__searchingInfo__segment__inner">
							<div class="nemo-flights-form__searchingInfo__segment__date" data-bind="text: items.departureDate.value() ? items.departureDate.value().getDate() + ' ' + items.departureDate.value().getMonthName() + ', ' + items.departureDate.value().getDOWName() : ''"></div>
							<div class="nemo-flights-form__searchingInfo__segment__route">
								<span class="nemo-flights-form__searchingInfo__segment__route__departure" data-bind="text: items.departure.value() ? items.departure.value().city.name : ''"></span>
								<span class="nemo-flights-form__searchingInfo__segment__route__arrival" data-bind="text: items.arrival.value() ? items.arrival.value().city.name : ''"></span>
							</div>
						</div>
					</div><!--
				--></div>
			</div>
		</div>
	<!-- /ko -->

	<!-- ko if: searchError -->
		<div data-bind="automaticPopup: {title: 'Ошибка', close: function () {searchError(false);}}">
			<div data-bind="text: searchError" style="display: none;"></div>
		</div>
	<!-- /ko -->
<!-- /ko -->

<!-- ko if: $$error() -->
<div data-bind="text: $$error()"></div>
<!-- /ko -->

<!-- ko if: $$loading() -->
	<div class="nemo-flights-form__loader"></div>
<!-- /ko -->

<!-- Last searches component -->
<!--<div class="" data-bind="component: {name: 'FlightsLastSearches/FlightsLastSearchesController',params: {}}">Loading last searches...</div>-->
</div>