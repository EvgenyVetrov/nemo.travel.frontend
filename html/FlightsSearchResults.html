<div data-bind="component: {name: 'Common/BreadCrumbs/Controller', params: {
		component: $data,
		includeComponent: {
			name: 'Flights/LastSearches/Controller',
			params: {}
		}
	}}"></div>

<div class="nemo-flights-results js-nemoApp__component">
	<!-- ko if: !$$loading() && !$$error() -->

		<!-- ko if: typeof matrixData != 'undefined' -->
		<section class="nemo-flights-results__matrixContainer" data-bind="template: {name: 'nemo-koTemplate-FlightsResults-DatesMatrix', data: $data}"></section>
		<!-- /ko -->

		<!-- Actual form -->
		<!-- ko if: formActive() -->
		<section class="nemo-flights-results__form" data-bind="
			component: {
	            name: 'Flights/SearchForm/Controller',
				params: {route: [], formData: $$rawdata}
			}
			"></section>
		<!-- /ko -->

		<!-- Form dummy -->
		<section class="nemo-flights-results__formDummy">
			<div class="new-ui-button new-ui-button_common nemo-flights-results__formDummy__filterSwitch" data-bind="click: function () {PFActive(!PFActive());}, css: {'nemo-flights-results__formDummy__filterSwitch_active': PFActive()}">
				Фильтрация
			</div><div class="nemo-flights-results__formDummy__inner" data-bind="visible: !formActive()">
				<div
					data-bind="
						foreach: searchInfo.segments,
						attr: {'class':'nemo-flights-results__formDummy__route nemo-flights-results__formDummy__route_' + searchInfo.tripType}
					">
					<div class="nemo-flights-results__formDummy__route__segment">

						<!-- ko if: $parent.searchInfo.tripType != 'RT' || $index() != 1 -->
							<div class="nemo-flights-results__formDummy__route__segment__geo nemo-flights-results__formDummy__route__segment__geo_departure" data-bind="with: departure">
								<span
									class="nemo-flights-results__formDummy__route__segment__geo__main"
									data-bind="text: name">
								</span><span
									class="nemo-flights-results__formDummy__route__segment__geo__aux"
									data-bind="text: ', ' + (!isCity && city && name != city.name ? city.name + ', ' : '') + country.name"></span>
							</div>
							<div class="nemo-flights-results__formDummy__route__segment__geo nemo-flights-results__formDummy__route__segment__geo_arrival" data-bind="with: arrival">
								<span
									class="nemo-flights-results__formDummy__route__segment__geo__main"
									data-bind="text: name">
								</span><span
									class="nemo-flights-results__formDummy__route__segment__geo__aux"
									data-bind="text: ', ' + (!isCity && city && name != city.name ? city.name + ', ' : '') + country.name"></span>
							</div>
						<!-- /ko -->

						<div class="nemo-flights-results__formDummy__route__segment__date">
							<!-- ko text:
								(
									$parent.searchInfo.tripType == 'RT' ?
									$root.i18n('FlightsSearchResults', 'formDummy__route__rt__' + ($index() == 0 ? 'flight' : 'return')) + ' ' :
									''
								) +
								departureDate.getDate() +
								' ' +
								departureDate.getMonthName() +
								', ' +
								departureDate.getDOWName() --><!-- /ko -->
						</div>
					</div>
				</div>

				<div class="nemo-flights-results__formDummy__passengers" data-bind="text: passengersSummary()"></div>

				<div
					class="new-ui-button nemo-flights-results__formDummy__switch"
					data-bind="text: $root.i18n('FlightsSearchResults', 'formDummy__switch'), click: function () {formActive(!formActive())}"></div>
			</div>

			<!-- ko if: PFActive() -->
			<div
					class="nemo-common-postFilters nemo-flights-results__formDummy__filters"
					data-bind="template: {name: 'nemo-koTemplate-FlightsResults-PostFilters', data: $data}">
			</div>
			<!-- /ko -->
		</section>

	<section class="nemo-flights-results__compareTable">
		<div class="nemo-flights-results__compareTable__opener js-flights-results__compareTable__opener"
		     data-bind="flightsResultsCompareTableToggle:none">
			<div class="nemo-flights-results__compareTable__opener__text"
			     data-bind="text: $root.i18n('FlightsSearchResults','compareTableSwitcher_open')"></div>
		</div>
		<section class="nemo-flights-results__compareTable__root nemo-flights-results__compareTable__root_closed">
		<div class="nemo-flights-results__compareTable__wrapper js-flights-results__compareTable__wrapper"
		     data-bind="flightsResultsCompareTableWidth:flightsCompareTableTransfer()">
			<div class="nemo-flights-results__compareTable__inner_hidden js-flights-results__compareTable__inner_hidden"
			     data-bind="foreach: flightsCompareTableTransfer().groups">
				<!-- ko if: !groupsFilteredOut() -->
				<div class="nemo-flights-results__compareTable__groups js-flights-results__compareTable__groups"
				     data-bind="foreach: groups">
					<!-- ko if: !filteredOut() -->
					<div class="nemo-flights-results__compareTable__groupsItem nemo-flights-results__compareTable__groupsItem_hidden js-flights-results__compareTable__groupsItem"
					     data-bind="attr:{'data-flightId':$data.flights[0].id}">
						<!-- ko if: !filteredOut() -->
						<div class="nemo-flights-results__compareTable__groupsItem__shortInfo">
							<div class="nemo-flights-results__compareTable__groupsItem__price"
							     data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency()">
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__duration"
							     data-bind="text: durationOnLegString().readableString() != 0 ? durationOnLegString().readableString() : $root.i18n('FlightsSearchResults', 'flightsCompareTable__unknownFlightTime');">
							</div>
						</div>
						<div class="nemo-flights-results__compareTable__groupsItem__fullInfo">
							<a class="new-ui-pseudoLink nemo-flights-results__compareTable__groupsItem__linkToFullTicket"
							   data-bind="attr{'data-FirstFlightId':$data.flights[0].id},
								   text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__goToTicket')"></a>
							<!--<div data-bind="foreach: flights">-->
							<!--<strong data-bind="text:totalTimeEnRoute.length"></strong>-->
							<!--</div>-->
							<div class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap"
							     data-bind="foreach: legGroupings">
											<span class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap__tip"
											      data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__time')"></span>
								<select style="max-width: 100%"
								        data-bind="options: options,
												value: selected,
												optionsText: function (item) {return $parent.getSelectedFlightsData(item, $index())},
										optionsAfterRender: setOptionDisable
										"></select>
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__buttonWrap">
								<!-- ko if: selectedFlightsIds().length -->
								<button class="new-ui-button nemo-flights-results__compareTable__groupsItem__buyButton"
								        data-bind="click: function () {resultsController.bookFlight(selectedFlightsIds());},
													text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__buy')">
								</button>
								<!-- /ko -->
								<!-- ko if: !selectedFlightsIds().length -->
								<strong>--- NO COMBINABLE FLIGHTS ---</strong>
								<!-- /ko -->
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__disclaimer"
							     data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__disclaimerPrice')">
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__disclaimer"
							     data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__disclaimerTime')">
							</div>
						</div>
						<!-- /ko -->
					</div>
					<!-- /ko -->
				</div>
				<!-- /ko -->
			</div>
			<div class="nemo-flights-results__compareTable nemo-flights-results__compareTable_flightsTransfer"
			     data-bind="flightsResultsCompareTableWidth:flightsCompareTableTransfer()">
				<div class="nemo-flights-results__compareTable__pager" data-bind="with: flightsCompareTableTransfer">
					<a href="#" class="nemo-flights-results__compareTable__pager__prev"
					   data-bind="click: paginationPrev, style: {'visibility':paginationHasPrev() == true ?'visible':'hidden'}">
						&#9664;</a>
					<div class="nemo-flights-results__compareTable__title"
					     data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__transferFlights') + ' ('+$data.groups.length+')'">
					</div>
					<a href="#" class="nemo-flights-results__compareTable__pager__next"
					   data-bind="click: paginationNext, style: {'visibility':paginationHasNext() == true ?'visible':'hidden'}">
						&#9654;</a>
				</div>
				<div class="nemo-flights-results__compareTable__inner"
				     data-bind="foreach: flightsCompareTableTransfer().groups,
						flightsResultsCompareTablePosition:flightsCompareTableTransfer()">
					<!-- ko if: !groupsFilteredOut() -->
					<div class="nemo-flights-results__compareTable__companyColumn js-flights-results__compareTable__companyColumn"
					     data-bind="flightsResultsCompareTableVisibleClass:$parents[0].flightsCompareTableTransfer(),null,null,$data">
						<div class="nemo-flights-results__compareTable__companyLogo">
							<div class="nemo-flights-results__compareTable__companyLogo__image" data-bind="style: { backgroundImage: 'url('+$root.controller.options.staticInfoURL+company.logo.icon+')' }"></div>
						</div>
						<div class="nemo-flights-results__compareTable__groups js-flights-results__compareTable__groups"
						     data-bind="foreach: groups">
							<!-- ko if: !filteredOut() -->
							<div class="nemo-flights-results__compareTable__groupsItem  nemo-flights-results__compareTable__groupsItem_minimized js-flights-results__compareTable__groupsItem"
							     data-bind="visible:($parents[1].flightsCompareTableTransfer().allGroupsVisible()
									&&
									$($element).parents('.js-flights-results__compareTable__companyColumn').hasClass('js-flights-results__compareTable__companyColumn_visible')) ? true : $index() < 2,
									flightsResultsCompareTableCloneCell:null,
									attr:{'data-flightId':$data.flights[0].id}">
								<!-- ko if: !filteredOut() -->
								<div class="nemo-flights-results__compareTable__groupsItem__shortInfo">
									<div class="nemo-flights-results__compareTable__groupsItem__price"
									     data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency()">
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__duration"
									     data-bind="text: durationOnLegString().readableString() != 0 ? durationOnLegString().readableString() : $root.i18n('FlightsSearchResults', 'flightsCompareTable__unknownFlightTime');">
									</div>
								</div>
								<div class="nemo-flights-results__compareTable__groupsItem__fullInfo">
									<a class="new-ui-pseudoLink nemo-flights-results__compareTable__groupsItem__linkToFullTicket"
									   data-bind="attr{'data-FirstFlightId':$data.flights[0].id},
										   text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__goToTicket')"></a>
									<!--<div data-bind="foreach: flights">-->
									<!--<strong data-bind="text:totalTimeEnRoute.length"></strong>-->
									<!--</div>-->
									<div class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap"
									     data-bind="foreach: legGroupings">
											<span class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap__tip"
											      data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__time')"></span>
										<select style="max-width: 100%"
										        data-bind="
														options: options,
																value: selected,
																optionsText: function (item) {return $parent.getSelectedFlightsData(item, $index())},
														optionsAfterRender: setOptionDisable
														"></select>
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__buttonWrap">
										<!-- ko if: selectedFlightsIds().length -->
										<button class="new-ui-button nemo-flights-results__compareTable__groupsItem__buyButton"
										        data-bind="click: function () {resultsController.bookFlight(selectedFlightsIds());},
													text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__buy')">
										</button>
										<!-- /ko -->
										<!-- ko if: !selectedFlightsIds().length -->
										<strong>--- NO COMBINABLE FLIGHTS ---</strong>
										<!-- /ko -->
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__disclaimer"
									     data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__disclaimerPrice')">
									</div><div class="nemo-flights-results__compareTable__groupsItem__disclaimer"
									           data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__disclaimerTime')">
								</div>
								</div>
								<!-- /ko -->
							</div>
							<!-- /ko -->
						</div>
					</div>
					<!-- /ko -->
				</div>
			</div>
			<div class="nemo-flights-results__compareTable__showMore__container" data-bind="with: flightsCompareTableTransfer">
				<a class="nemo-flights-results__compareTable__showMore__switch"
				   data-bind="html:$data.allGroupsVisible()
					   ? $root.i18n('FlightsSearchResults', 'flightsCompareTable__showLess') + '<span class=\'nemo-flights-results__compareTable__showMore__switch__icon\'>&#9650;<\/span>'
					   : $root.i18n('FlightsSearchResults', 'flightsCompareTable__showMore') + '<span class=\'nemo-flights-results__compareTable__showMore__switch__icon\'>&#9660;<\/span>',
				   click:$data.toggleVisibleGroups(),
				   visible:$data.flagToShowMore()"></a>
			</div>
		</div>
		<div class="nemo-flights-results__compareTable__wrapper js-flights-results__compareTable__wrapper"
		     data-bind="flightsResultsCompareTableWidth:flightsCompareTableDirect()">
			<div class="nemo-flights-results__compareTable__inner_hidden js-flights-results__compareTable__inner_hidden"
			     data-bind="foreach: flightsCompareTableDirect().groups">
				<!-- ko if: !groupsFilteredOut() -->
				<div class="nemo-flights-results__compareTable__groups js-flights-results__compareTable__groups"
				     data-bind="foreach: groups">
					<!-- ko if: !filteredOut() -->
					<div class="nemo-flights-results__compareTable__groupsItem nemo-flights-results__compareTable__groupsItem_hidden js-flights-results__compareTable__groupsItem"
					     data-bind="attr:{'data-flightId':$data.flights[0].id}">
						<!-- ko if: !filteredOut() -->
						<div class="nemo-flights-results__compareTable__groupsItem__shortInfo">
							<div class="nemo-flights-results__compareTable__groupsItem__price"
							     data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency()">
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__duration"
							     data-bind="text: durationOnLegString().readableString() != 0 ? durationOnLegString().readableString() : $root.i18n('FlightsSearchResults', 'flightsCompareTable__unknownFlightTime');">
							</div>
						</div>
						<div class="nemo-flights-results__compareTable__groupsItem__fullInfo">
							<a class="new-ui-pseudoLink nemo-flights-results__compareTable__groupsItem__linkToFullTicket"
							   data-bind="attr{'data-FirstFlightId':$data.flights[0].id},
								   text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__goToTicket')"></a>
							<!--<div data-bind="foreach: flights">-->
							<!--<strong data-bind="text:totalTimeEnRoute.length"></strong>-->
							<!--</div>-->
							<div class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap"
							     data-bind="foreach: legGroupings">
											<span class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap__tip"
											      data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__time')"></span>
								<select style="max-width: 100%"
								        data-bind="options: options,
												value: selected,
												optionsText: function (item) {return $parent.getSelectedFlightsData(item, $index())},
										optionsAfterRender: setOptionDisable
										"></select>
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__buttonWrap">
								<!-- ko if: selectedFlightsIds().length -->
								<button class="new-ui-button nemo-flights-results__compareTable__groupsItem__buyButton"
								        data-bind="click: function () {resultsController.bookFlight(selectedFlightsIds());},
													text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__buy')">
								</button>
								<!-- /ko -->
								<!-- ko if: !selectedFlightsIds().length -->
								<strong>--- NO COMBINABLE FLIGHTS ---</strong>
								<!-- /ko -->
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__disclaimer"
							     data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__disclaimerPrice')">
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__disclaimer"
							     data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__disclaimerTime')">
							</div>
						</div>
						<!-- /ko -->
					</div>
					<!-- /ko -->
				</div>
				<!-- /ko -->
			</div>
			<div class="nemo-flights-results__compareTable nemo-flights-results__compareTable_flightsDirect"
			     data-bind="flightsResultsCompareTableWidth:flightsCompareTableDirect()">
				<div class="nemo-flights-results__compareTable__pager" data-bind="with: flightsCompareTableDirect">
					<a href="#" class="nemo-flights-results__compareTable__pager__prev"
					   data-bind="click: paginationPrev, style: {'visibility':paginationHasPrev() == true ?'visible':'hidden'}">
						&#9664;</a>
					<div class="nemo-flights-results__compareTable__title"
					     data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__directFlights') + ' ('+$data.groups.length+')'">
					</div>
					<a href="#" class="nemo-flights-results__compareTable__pager__next"
					   data-bind="click: paginationNext, style: {'visibility':paginationHasNext() == true ?'visible':'hidden'}">
						&#9654;</a>
				</div>
				<div class="nemo-flights-results__compareTable__inner"
				     data-bind="foreach: flightsCompareTableDirect().groups,
						flightsResultsCompareTablePosition:flightsCompareTableDirect()">
					<!-- ko if: !groupsFilteredOut() -->
					<div class="nemo-flights-results__compareTable__companyColumn js-flights-results__compareTable__companyColumn"
					     data-bind="flightsResultsCompareTableVisibleClass:$parents[0].flightsCompareTableDirect(),null,null,$data">
						<div class="nemo-flights-results__compareTable__companyLogo">
							<div class="nemo-flights-results__compareTable__companyLogo__image" data-bind="style: { backgroundImage: 'url('+$root.controller.options.staticInfoURL+company.logo.icon+')' }"></div>
						</div>
						<div class="nemo-flights-results__compareTable__groups js-flights-results__compareTable__groups"
						     data-bind="foreach: groups">
							<!-- ko if: !filteredOut() -->
							<div class="nemo-flights-results__compareTable__groupsItem  nemo-flights-results__compareTable__groupsItem_minimized js-flights-results__compareTable__groupsItem"
							     data-bind="visible:($parents[1].flightsCompareTableDirect().allGroupsVisible()
									&&
									$($element).parents('.js-flights-results__compareTable__companyColumn').hasClass('js-flights-results__compareTable__companyColumn_visible')) ? true : $index() < 2,
									flightsResultsCompareTableCloneCell:null,
									attr:{'data-flightId':$data.flights[0].id}">
								<!-- ko if: !filteredOut() -->
								<div class="nemo-flights-results__compareTable__groupsItem__shortInfo">
									<div class="nemo-flights-results__compareTable__groupsItem__price"
									     data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency()">
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__duration"
									     data-bind="text: durationOnLegString().readableString() != 0 ? durationOnLegString().readableString() : $root.i18n('FlightsSearchResults', 'flightsCompareTable__unknownFlightTime');">
									</div>
								</div>
								<div class="nemo-flights-results__compareTable__groupsItem__fullInfo">
									<a class="new-ui-pseudoLink nemo-flights-results__compareTable__groupsItem__linkToFullTicket"
									   data-bind="attr{'data-FirstFlightId':$data.flights[0].id},
										   text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__goToTicket')"></a>
									<!--<div data-bind="foreach: flights">-->
									<!--<strong data-bind="text:totalTimeEnRoute.length"></strong>-->
									<!--</div>-->
									<div class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap"
									     data-bind="foreach: legGroupings">
											<span class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap__tip"
											      data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__time')"></span>
										<select style="max-width: 100%"
										        data-bind="
														options: options,
																value: selected,
																optionsText: function (item) {return $parent.getSelectedFlightsData(item, $index())},
														optionsAfterRender: setOptionDisable
														"></select>
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__buttonWrap">
										<!-- ko if: selectedFlightsIds().length -->
										<button class="new-ui-button nemo-flights-results__compareTable__groupsItem__buyButton"
										        data-bind="click: function () {resultsController.bookFlight(selectedFlightsIds());},
													text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__buy')">
										</button>
										<!-- /ko -->
										<!-- ko if: !selectedFlightsIds().length -->
										<strong>--- NO COMBINABLE FLIGHTS ---</strong>
										<!-- /ko -->
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__disclaimer"
									     data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__disclaimerPrice')">
									</div><div class="nemo-flights-results__compareTable__groupsItem__disclaimer"
									           data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__disclaimerTime')">
								</div>
								</div>
								<!-- /ko -->
							</div>
							<!-- /ko -->
						</div>
					</div>
					<!-- /ko -->
				</div>
			</div>
			<div class="nemo-flights-results__compareTable__showMore__container" data-bind="with: flightsCompareTableDirect">
				<a class="nemo-flights-results__compareTable__showMore__switch"
				   data-bind="html:$data.allGroupsVisible()
					   ? $root.i18n('FlightsSearchResults', 'flightsCompareTable__showLess') + '<span class=\'nemo-flights-results__compareTable__showMore__switch__icon\'>&#9650;<\/span>'
					   : $root.i18n('FlightsSearchResults', 'flightsCompareTable__showMore') + '<span class=\'nemo-flights-results__compareTable__showMore__switch__icon\'>&#9660;<\/span>',
				   click:$data.toggleVisibleGroups(),
				   visible:$data.flagToShowMore()"></a>
			</div>
		</div>
		<div class="nemo-flights-results__compareTable__root__closeSwitch"
		     data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__showLess'),
					flightsResultsCompareTableToggle:none"></div>
		</section>
	</section>

	<section class="nemo-flights-results__content">

        <aside
	        class="nemo-common-postFilters nemo-flights-results__content__postfilters"
	        data-bind="template: {name: 'nemo-koTemplate-FlightsResults-PostFilters', data: $data}, customScroll, flightsResultsContainerSticky">
        </aside>

			<section class="new-ui-subContainer nemo-flights-results__content__results">
				<!-- ko if: visibleResultsCount() > 0 -->
					<div class="nemo-flights-results__showcase">

                        <div class="nemo-flights-results__showcase__main">
						<!-- ko if: showcase.recommended() -->
							<!-- ko with: {group: showcase.recommended(), modifier: 'recommended'} -->
								<div class="nemo-flights-results__showcase__item nemo-flights-results__showcase__item_recommended"
								     data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', data: group }"></div>
							<!-- /ko -->
						<!-- /ko -->
                        </div>

                        <div class="nemo-flights-results__showcase__additional">
						<!-- ko if: showcase.cheapest() -->
							<!-- ko with: {group: showcase.cheapest(), modifier: 'cheapest'} -->
								<div class="nemo-flights-results__showcase__additional__item nemo-flights-results__showcase__item_cheapest"
								     data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', data: group }"></div>
							<!-- /ko -->
						<!-- /ko -->

						<!-- ko if: showcase.fastest() -->
							<!-- ko with: {group: showcase.fastest(), modifier: 'fastest'} -->
								<div class="nemo-flights-results__showcase__additional__item nemo-flights-results__showcase__item_fastest"
								     data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', data: group }"></div>
							<!-- /ko -->
						<!-- /ko -->
                        </div>
					</div>
				<!-- /ko -->
				<div class="nemo-flights-results__content__results__controls">
					<div
						class="nemo-flights-results__content__results__controls__item nemo-flights-results__content__results__controls__item_count"
						data-bind="text:
									$root.i18n('FlightsSearchResults', 'controls__count_' + (visibleResultsCount() == totalResultsCount ? 'all' : 'filtered'))
										.replace('[%-count-%]', visibleResultsCount())
										.replace('[%-total-%]', totalResultsCount)"></div>
					<div class="nemo-flights-results__content__results__controls__item nemo-flights-results__content__results__controls__item_sorting">
						<span class="nemo-flights-results__content__results__controls__item__sortTitle">
							Сортировать по
						</span>
						<select data-bind="
							simpleSelect: {
								data: possibleSorts,
								i18nSegment: 'FlightsSearchResults',
								containerCssClass: 'nemo-flights-results__commonSelect',
								i18nPrefix: 'sortType_'
							},
							value: sort
						"></select>
					</div>
				</div>

				<div cclass="nemo-flights-results__groupList" data-bind="foreach: groups">
					<!-- ko if: !filteredOut() -->
					<div class="nemo-flights-results__groupList__item" data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', data: $data }"></div>
					<!-- /ko -->
				</div>

				<!-- ko if: visibleResultsCount() == 0 -->
				<h2 class="new-ui-subSectionHeader">Ничего не найдено</h2>
				<!-- /ko -->
			</section>

			<aside class="nemo-flights-results__content__offers">
				<div class="nemo-flights-results__content__offers__text">
					<div class="nemo-flights-results__content__offers__text__header">Топ-3 авиакомпаний</div>
					Обратите внимание на билеты от лучших авиакомпаний на рынке, это гарантия комфортного путешествия и качественного обслуживания.
				</div>
				<!-- ko with: {groups: showcase.bestCompanies, modifier: 'bestCompanies'} -->
					<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', foreach: groups }"></div>
				<!-- /ko -->
			</aside>
		</section>
	<!-- /ko -->

	<!-- ko if: $$loading -->
	<div class="new-ui-subContainer nemo-flights-results__loader"></div>
	<!-- /ko -->

	<!-- ko if: $$error -->
	<div class="new-ui-subContainer nemo-flights-results__error" data-bind="text: $$error() + console.log($$error())"></div>
	<!-- /ko -->

	<!-- PF TEMPLATES -->
    <script id="nemo-koTemplate-FlightsResults-PF-String" type="text/html">

        <label class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value nemo-common-postFilters__filterList__filter__valuesBlock__values__value_noMatter"
               data-bind="  css: { 'nemo-common-postFilters__filterList__filter__valuesBlock__values__value_checked' : (!($parent.value())) || ($parent.value() == '') },
                            click: clear
               ">

            <span class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value__name nemo-common-postFilters__filterList__filter__valuesBlock__values__value__name_noMatter">Все равно</span>

        </label>

        <!-- ko foreach: values -->
        <label class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value"
               data-bind="css: {
                    'nemo-common-postFilters__filterList__filter__valuesBlock__values__value_disabled' : count() == 0,
                    'nemo-common-postFilters__filterList__filter__valuesBlock__values__value_checked' : $parent.value() instanceof Array ? $parent.value().indexOf(key) >= 0 : $parent.value() == key
                }">

            <input class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value__input"
                   data-bind="attr: {
								value: key,
								type: $parent.type == 'singleChoice' ? 'radio' : 'checkbox',
								disabled: count() == 0
							},
							checked: $parent.value">

            <span class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value__name"
                  data-bind="text: ($parent.config.name == 'carrier' || $parent.config.name == 'departureAirport' || $parent.config.name == 'arrivalAirport' ? value.name : $root.i18n('FlightsSearchResults', 'PF__value_' + $parent.config.name + '_' + value))
            "></span>

            <span class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value__price" data-bind="text: addValue() ? 'от ' + addValue().normalizedAmount() + ' ' + addValue().currency() : ''">
                <!-- ko if: addValue() --><!-- /ko -->
            </span>

            <span class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value__quantity" data-bind="text: count() "></span>
        </label>
        <!-- /ko -->

    </script>

	<!-- Flights group -->
	<script id="nemo-koTemplate-FlightsResults-Group" type="text/html">
		<!-- TODO add carrier coloring here -->
		<div data-bind="attr: {
				'class': 'new-ui-subContainer nemo-flights-results__flightsGroup js-flights-results__group ' +
						($parent.modifier ? 'nemo-flights-results__flightsGroup_' + $parent.modifier : '') +
						' ' +
						(!$parent.modifier || $parent.modifier == 'recommended' ? 'nemo-flights-results__flightsGroup_common' : '') +
						' ' +
						'new-ui-subContainer nemo-flights-results__flightsGroup_legsCount_' + legGroupings.length
			}">
			<div class="new-ui-subContainer__header nemo-flights-results__flightsGroup__header">
				<div class="nemo-flights-results__flightsGroup__header__title">
					<div class="nemo-common-ffEllipsisHack">
						<div class="nemo-common-ffEllipsisHack__inner" data-bind="text: $parent.modifier && $parent.modifier != 'bestCompanies' ? $root.i18n('FlightsSearchResults', 'flightsGroup__header_' + $parent.modifier) : getValidatingCompany().name"></div>
					</div>
				</div>
				<div class="nemo-flights-results__flightsGroup__header__additional">
					<div class="nemo-flights-results__flightsGroup__rating nemo-flights-results__flightsGroup__rating_inHeader" data-bind="foreach: getValidatingCompany().ratingItems"><!--
						--><div class="nemo-flights-results__flightsGroup__rating__item" data-bind="css:{'nemo-flights-results__flightsGroup__rating__item_active': $data}"></div><!--
					--></div><!--
					--><img class="nemo-flights-results__flightsGroup__header__logo"
					     data-bind="attr: {src: $root.controller.options.staticInfoURL + getValidatingCompany().logo.image}"><!--
					     ko if: carriersMismatch
				    --><div
							class="nemo-flights-results__flightsGroup__header__info"
							data-bind="tooltip: {
								header: $root.i18n('FlightsSearchResults','flightsGroup__header__carrierMismatch__header'),
								content: $root.i18n('FlightsSearchResults','flightsGroup__header__carrierMismatch__content').replace('[%-validatingCarrier-%]', getValidatingCompany().name),
								cssClass: 'nemo-flights-results__flightsGroup__header__infoTooltip'
							}"></div>
					<!-- /ko -->
				</div>
			</div>

			<div class="nemo-flights-results__flightsGroup__subHeader">
				<div class="nemo-flights-results__flightsGroup__subHeader__title">
					Рейтинг авиакомпании
				</div>

				<div class="nemo-flights-results__flightsGroup__subHeader__additional">
					<div class="nemo-flights-results__flightsGroup__rating nemo-flights-results__flightsGroup__rating_inSubHeader" data-bind="foreach: getValidatingCompany().ratingItems"><!--
						--><div class="nemo-flights-results__flightsGroup__rating__item" data-bind="css:{'nemo-flights-results__flightsGroup__rating__item_active': $data}"></div><!--
					--></div>
				</div>
			</div>

			<div data-bind="foreach: legGroupings, attr: {'class': 'nemo-flights-results__flightsGroup__legs nemo-flights-results__flightsGroup__legs_count_' + legGroupings.length}"><!--
				--><div class="nemo-flights-results__flightsGroup__leg">
					<div class="nemo-flights-results__flightsGroup__leg__info" data-bind="with: $parent.flights[0].legs[$index()]">
						<div class="nemo-flights-results__flightsGroup__leg__info__date">
							<span class="nemo-flights-results__flightsGroup__leg__info__date__day" data-bind="text: depDateTime.getDate() + ' ' + depDateTime.getMonthName()">
							</span><span class="nemo-flights-results__flightsGroup__leg__info__date__dayOfWeek" data-bind="text: ', ' + depDateTime.getDOWName()"></span>
						</div>

						<div class="nemo-flights-results__flightsGroup__leg__info__route">
							<div class="nemo-common-ffEllipsisHack">
								<div class="nemo-common-ffEllipsisHack__inner">
									<div
										class="nemo-flights-results__flightsGroup__leg__info__route__departure"
										data-bind="text: depAirp.city.name">
									</div><div
										class="nemo-flights-results__flightsGroup__leg__info__route__arrival"
										data-bind="text: arrAirp.city.name"></div>
								</div>
							</div>
						</div>
					</div>

					<div class="nemo-flights-results__flightsGroup__leg__selector">
						<div class="nemo-flights-results__flightsGroup__leg__selector__header">
							<div class="nemo-flights-results__flightsGroup__leg__selector__header__title">
								<div class="nemo-common-ffEllipsisHack">
									<div class="nemo-common-ffEllipsisHack__inner">
										<div
												class="
													nemo-flights-results__flightsGroup__leg__selector__header__title__text
													nemo-flights-results__flightsGroup__leg__selector__header__title__text_short
												"
												data-bind="text: $root.i18n('FlightsSearchResults','flightsGroup__selector__title');"></div>
										<div
												class="
													nemo-flights-results__flightsGroup__leg__selector__header__title__text
													nemo-flights-results__flightsGroup__leg__selector__header__title__text_dates
												"
												data-bind="with: $parent.flights[0].legs[$index()]">
											<span class="nemo-flights-results__flightsGroup__leg__selector__header__title__text__day" data-bind="text: depDateTime.getDate() + ' ' + depDateTime.getMonthName()">
											</span><span class="nemo-flights-results__flightsGroup__leg__selector__header__title__text__dayOfWeek" data-bind="text: ', ' + depDateTime.getDOWName()"></span>
										</div>
										<div
											class="nemo-flights-results__flightsGroup__leg__selector__header__title__date"
											data-bind="with: $parent.flights[0].legs[$index()]">
											<span
												class="nemo-flights-results__flightsGroup__leg__selector__header__title__date__day"
												data-bind="text: depDateTime.getDate() + ' ' + depDateTime.getMonthName()">
											</span><span
												class="nemo-flights-results__flightsGroup__leg__selector__header__title__date__dayOfWeek"
												data-bind="text: ', ' + depDateTime.getDOWNameShort()"></span>
										</div>
									</div>
								</div>
							</div><div
								class="nemo-flights-results__flightsGroup__leg__selector__header__seatsAvailable"
								data-bind="
									text:
										$parent.selectedFlight().availSeats > 0 ?
										(
											$parent.selectedFlight().availSeats +
											' ' +
											$root.i18n(
												'FlightsSearchResults',
												'flightsGroup__availSeats_' + $root.helpers.getNumeral($parent.selectedFlight().availSeats, 'one', 'twoToFour', 'fourPlus')
											)
										):
										'',
									css: {'nemo-flights-results__flightsGroup__leg__selector__header__seatsAvailable_warning' : $parent.selectedFlight().availSeats > 0 && $parent.selectedFlight().seatsAvailThreshold >= $parent.selectedFlight().availSeats}"></div>
						</div>

						<div class="nemo-flights-results__flightsGroup__leg__selector__selectContainer">
							<!--<select-->
									<!--class="nemo-flights-results__flightsGroup__leg__selector__realselect"-->
									<!--data-bind="-->
												<!--options: options,-->
												<!--value: selected,-->
												<!--optionsText: function (item) {return $parent.getSelectedFlightsData(item, $index())},-->
												<!--optionsAfterRender: setOptionDisable-->
											<!--"></select>-->
							<div
								class="nemo-flights-results__flightsGroup__leg__selector__selected"
								data-bind="
									css: {
										'nemo-flights-results__flightsGroup__leg__selector__selected_unopenable': selectableCount() <= 1,
										'nemo-flights-results__flightsGroup__leg__selector__selected_open': open()
									},
									flightsResultsFlightSelector: $data,
									with: $parent.selectedFlight().legs[$index()]">
								<div class="nemo-flights-results__flightsGroup__leg__selector__selected__time">
									<span class="nemo-flights-results__flightsGroup__leg__selector__selected__time__departure" data-bind="text: depDateTime.getHours() + ':' + depDateTime.getMinutes()"></span>
									&mdash;
									<span class="nemo-flights-results__flightsGroup__leg__selector__selected__time__arrival" data-bind="text: arrDateTime.getHours() + ':' + arrDateTime.getMinutes()"></span>
									<!-- ko if: depDateTime.getDate() != arrDateTime.getDate() -->
										<span class="nemo-flights-results__flightsGroup__leg__selector__selected__time__nextDayDate">
											(<!-- ko text: arrDateTime.getDate() + ' ' + arrDateTime.getMonthNameShort() --><!-- /ko -->)
										</span>
									<!-- /ko -->
								</div>
								<div class="nemo-flights-results__flightsGroup__leg__selector__selected__timeEnRoute">
									<!-- ko text: timeEnRoute.readableStringShort() --><!-- /ko -->
									<span class="nemo-flights-results__flightsGroup__leg__selector__selected__timeEnRoute__addText">в пути</span>
								</div>
							</div>
							<!-- ko if: open -->
							<div class="nemo-flights-results__flightsGroup__leg__selector__dropdown" data-bind="foreach: options">
								<!-- ko if: !disabled() -->
									<div
										class="nemo-flights-results__flightsGroup__leg__selector__dropdown__option"
										data-bind="
										click: function () {$parent.selected($data)},
										with: $parents[1].flightsById[$data.flights[0]].legs[$parentContext.$index()]
									">
										<span class="nemo-flights-results__flightsGroup__leg__selector__dropdown__option__departure" data-bind="text: depDateTime.getHours() + ':' + depDateTime.getMinutes()"></span>
										<span class="nemo-flights-results__flightsGroup__leg__selector__dropdown__option__transfers" data-bind="foreach: new Array(transfersCount)"><div class="nemo-flights-results__flightsGroup__leg__selector__dropdown__option__transfers__transfer"></div></span>
										<span
											class="nemo-flights-results__flightsGroup__leg__selector__dropdown__option__arrival"
											data-bind="css: {'nemo-flights-results__flightsGroup__leg__selector__dropdown__option__arrival_nextday': depDateTime.getDate() != arrDateTime.getDate()}">
											<!-- ko text: arrDateTime.getHours() + ':' + arrDateTime.getMinutes() --><!-- /ko -->
											<!-- ko if: depDateTime.getDate() != arrDateTime.getDate() -->
												<span class="nemo-flights-results__flightsGroup__leg__selector__dropdown__option__arrival__nextDayDate">
													(<!-- ko text: arrDateTime.getDate() + ' ' + arrDateTime.getMonthNameShort() --><!-- /ko -->)
												</span>
										<!-- /ko -->
										</span>
										<div class="nemo-flights-results__flightsGroup__leg__selector__dropdown__option__timeEnRoute" data-bind="text: timeEnRoute.readableString()"></div>
									</div>
								<!-- /ko -->
							</div>
							<!-- /ko -->
						</div>

						<div class="nemo-flights-results__flightsGroup__leg__selector__footer">
							<div class="nemo-flights-results__flightsGroup__leg__selector__footer__transfers">
								<!-- ko if: $parent.selectedFlight().transfers[$index()].length -->
									<div class="nemo-flights-results__flightsGroup__leg__selector__footer__transfers__short">
									    Пересадки <!-- ko text: $parent.selectedFlight().legs[$index()].timeTransfers.readableString() --><!-- /ko -->
									</div>
									<div
										class="nemo-flights-results__flightsGroup__leg__selector__footer__transfers__short__full"
										data-bind="foreach: $parent.selectedFlight().transfers[$index()]"><!--
											ko text: ($index() != 0 ? ', ' : '') + (place.city ? place.city.name : place.name) + ' (' + place.country.name + ')' --><!-- /ko
									--></div>
								<!-- /ko -->
								<!-- ko if: !$parent.selectedFlight().transfers[$index()].length -->
									<div class="nemo-flights-results__flightsGroup__leg__selector__footer__transfers__short">
										Без пересадок
									</div>
								<!-- /ko -->
							</div>
							<!-- "With" binding is needed here to reconstruct link on every flight change -->
							<div class="nemo-flights-results__flightsGroup__leg__selector__footer__detailsLink" data-bind="with: $parent.selectedFlight()">
								<span class="new-ui-pseudoLink" data-bind="
										popup: {
											block: 'flightInfoByLeg_' + $parentContext.$index(),
											title: 'Детали перелета',
											parentClass: 'js-flights-results__group',
											contentClass: 'nemo-flights-results__flightsGroup__flightInfo',
											beforeOpen: function () {$parent.detailsOpen(true);},
											close: function () {$parent.detailsOpen(false);}
										}">
									Детали
								</span>
							</div>
						</div>
					</div>
					<!-- ko if: detailsOpen -->
					<!-- ko with: {flight: $parent.selectedFlight(), leg: $index()} -->
						<div
							class="js-nemoApp__popupBlock"
							style="display: none;"
							data-bind="
								attr: {'data-block' : 'flightInfoByLeg_' + leg},
								template: { name: 'nemo-koTemplate-Flights-FlightInfo__oneLeg', data: flight }
							"></div>
					<!-- /ko -->
					<!-- /ko -->
				</div><!--
			--></div>

			<div class="nemo-flights-results__flightsGroup__footer">
				<div class="nemo-flights-results__flightsGroup__footer__couplingButtonContainer" data-bind="if: couplingTable && couplingTable.isActive">
					<div class="new-ui-button nemo-flights-results__flightsGroup__couplingButton" data-bind="popup: {
							block: 'couplingTable',
							title: 'Рейсы авиакомпании '+ getValidatingCompany().name,
							parentClass: 'js-flights-results__group',
							contentClass: 'nemo-flights-results__flightsGroup__couplingTablePopup',
							beforeOpen: function () {couplingTableOpen(true);},
							close: function () {couplingTableOpen(false);}
						}">
						<span class="new-ui-pseudoLink">
							Еще
							<!-- ko text: couplingTable.flights.length --><!-- /ko -->
							<span
								class="nemo-flights-results__flightsGroup__couplingButton__addText"
								data-bind="text: $root.i18n('FlightsSearchResults','flightsGroup__couplingButton__variants_' + $root.helpers.getNumeral(couplingTable.flights.length, 'one', 'twoToFour', 'fourPlus'))"></span>
						</span>
					</div>
				</div><div class="nemo-flights-results__flightsGroup__footer__buyButtonContainer">
					<div class="nemo-flights-results__flightsGroup__footer__buyButtonContainer__disclaimer" data-bind="html: $root.i18n('FlightsSearchResults','flightsGroup__footer__passengersDisclaimer')"></div>
					<money class="new-ui-button new-ui-button_main nemo-flights-results__flightsGroup__buyButton"
					       data-bind="money: getTotalPrice(), click: function () {resultsController.bookFlight(selectedFlightsIds());}" format="0,0 $"></money><!---->
				</div><div class="nemo-flights-results__flightsGroup__footer__disclaimer" data-bind="html: $root.i18n('FlightsSearchResults','flightsGroup__footer__passengersDisclaimer')"></div>
			</div>

			<!-- ko if: couplingTable && couplingTable.isActive && couplingTableOpen() -->
				<div
					class="js-nemoApp__popupBlock"
					data-block="couplingTable"
					style="display: none;"
					data-bind="template: { name: 'nemo-koTemplate-FlightsResults-CouplingTable', data: couplingTable }"></div>
			<!-- /ko -->
		</div>
	</script>

	<!-- Coupling table -->
	<script id="nemo-koTemplate-FlightsResults-CouplingTable" type="text/html">
		<div class="nemo-flights-results__couplingTable">
			<div class="nemo-flights-results__couplingTable__header">
				<div class="nemo-flights-results__couplingTable__header__title" data-bind="text: $root.i18n('FlightsSearchResults', 'couplingTable__sortHeader')"></div>

				<div class="new-ui-stateGroup new-ui-stateGroup_separate nemo-flights-results__couplingTable__header__sort" data-bind="foreach: sortTypes">
					<label class="new-ui-stateGroup__label nemo-flights-results__couplingTable__header__sort__item" data-bind="click: function () {$parent.sort($data);}">
						<input type="checkbox" class="new-ui-stateGroup__label__input" data-bind="checked: $data == $parent.sort()">
						<div class="new-ui-stateGroup__label__button nemo-flights-results__couplingTable__header__sort__button"
						     data-bind="
						        text: $root.i18n('FlightsSearchResults', 'couplingTable__sortType_' + $data),
								css: {'nemo-flights-results__couplingTable__header__sort__button_active': $data == $parent.sort()}
						"></div>
					</label>
				</div>
			</div>

			<div class="nemo-flights-results__couplingTable__groups" data-bind="foreach: legGroupings">
				<div
					class="nemo-flights-results__couplingTable__groups__group"
					data-bind="
						css: {'nemo-flights-results__couplingTable__groups__group_active': legActive() || $parent.legGroupings.length <= 2},
						click: function () {for (var i = 0; i < $parent.legGroupings.length; i++) {$parent.legGroupings[i].legActive(i == $index())}},
						foreach: flights
				">
					<!-- ko if: $index() == 0 -->
					<div class="nemo-flights-results__couplingTable__groups__group__header" data-bind="with: $parents[1].flightsById[$parent.flights()[0][0]].legs[$parentContext.$index()]">
						<div class="nemo-flights-results__couplingTable__groups__group__header__departure" data-bind="text: depAirp.city.name"></div>
						<div class="nemo-flights-results__couplingTable__groups__group__header__arrival" data-bind="text: arrAirp.city.name"></div>
						<div class="nemo-flights-results__couplingTable__groups__group__header__date" data-bind="text: depDateTime.getDate() + ' ' + depDateTime.getMonthName()"></div>
					</div>
					<!-- /ko -->

					<!--attr: {-->
					<!--style: 'padding: 5px;border: 1px solid;margin-bottom: 5px;' +-->
					<!--($data == $parent.selected() ? 'border-color: red;background: #eee;' : '') +-->
					<!--($parents[1].disabledGroupings[$parentContext.$index()].indexOf($data) >= 0 ? 'opacity: 0.5;' : '')-->
					<!--},-->
					<!--click: function () {$parents[1].selectVariant($data, $parentContext.$index())}-->

					<div class="nemo-flights-results__couplingTable__groups__group__item" data-bind="
						css: {
							'nemo-flights-results__couplingTable__groups__group__item_selected': $data == $parent.selected(),
							'nemo-flights-results__couplingTable__groups__group__item_inactive': $parents[1].disabledGroupings[$parentContext.$index()].indexOf($data) >= 0
						}
					">
						<div
							class="new-ui-button new-ui-button_common nemo-flights-results__couplingTable__groups__group__item__inner"
							data-bind="
								click: function () {$parents[1].selectVariant($data, $parentContext.$index())}">
							<!-- ko with: $parents[1].flightsById[$data[0]].legs[$parentContext.$index()] -->
								<span class="nemo-flights-results__couplingTable__groups__group__item__depTime" data-bind="text: depDateTime.getHours() + ':' + depDateTime.getMinutes()"></span>
								<span
									class="nemo-flights-results__couplingTable__groups__group__item__arrTime"
									data-bind="
										text: arrDateTime.getHours() + ':' + arrDateTime.getMinutes(),
										css: {'nemo-flights-results__couplingTable__groups__group__item__arrTime_nextDay': depDateTime.getDate() != arrDateTime.getDate()}
									"></span>
								<span class="nemo-flights-results__couplingTable__groups__group__item__timeEnRoute" data-bind="text: timeEnRoute.readableStringShort()"></span>
							<!-- /ko -->

							<!-- ko with: $parents[1].flightsById[$data[0]].transfers[$parentContext.$index()] -->
								<div class="nemo-flights-results__couplingTable__groups__group__item__transfers">
									<!-- ko if: $data.length == 1 -->
										<span class="nemo-flights-results__couplingTable__groups__group__item__transfers__caption">Через</span>
										<!-- ko text: $data[0].place.city.name --><!-- /ko -->
									<!-- /ko -->

									<!-- ko if: $data.length > 1 -->
										<!-- ko text: $data.length + ' ' + $root.i18n('FlightsSearchResults', 'couplingTable__group__item__transfers_' + $root.helpers.getNumeral($data.length, 'one', 'twoToFour', 'fourPlus')) --><!-- /ko -->
									<!-- /ko -->

									<!-- ko if: $data.length == 0 -->
										<!-- ko text: $root.i18n('FlightsSearchResults', 'couplingTable__group__item__transfers_none') --><!-- /ko -->
									<!-- /ko -->
								</div>
							<!-- /ko -->
						</div>
					</div>
				</div>
				<!-- ko if: $index() == ($parent.legGroupings.length - 1) -->
				<div class="nemo-flights-results__couplingTable__groups__buyGroup" data-bind="foreach: flights">
					<!-- ko if: $index() == 0 -->
					<div class="nemo-flights-results__couplingTable__groups__buyGroup__header"></div>
					<!-- /ko -->

					<!--($data == $parent.selected() ? 'border-color: red;background: #eee;' : '')-->
					<div class="nemo-flights-results__couplingTable__groups__buyGroup__item" data-bind="if: $parents[1].disabledGroupings[$parentContext.$index()].indexOf($data) < 0">
						<span class="new-ui-button new-ui-button_main nemo-flights-results__couplingTable__buyButton" data-bind="
							css: {'nemo-flights-results__couplingTable__buyButton_inactive': $data != $parent.selected()},
							click: function () {
								if ($data != $parent.selected()) {
									$parents[1].selectVariant($data, $parentContext.$index());
								}
								else {
									$parents[2].resultsController.bookFlight($parents[1].selectedFlightsIds());
								}
							}
						">
							<div class="nemo-flights-results__couplingTable__buyButton__text">Купить за</div>
							<money class="nemo-flights-results__couplingTable__buyButton__price" data-bind="money: $parents[1].flightsById[$data[0]].getTotalPrice()"></money>
						</span>
					</div>
				</div>
				<!-- /ko -->
			</div>
		</div>
	</script>

	<!-- Flights Info -->
	<script id="nemo-koTemplate-Flights-FlightInfo__oneLeg" type="text/html">
		<div class="nemo-flights-flightInfo">
			<div class="nemo-flights-flightInfo__leg">
				<div class="nemo-flights-flightInfo__leg__header">
					<img class="nemo-flights-flightInfo__leg__header__carrierLogo" data-bind="attr: {src: $root.controller.options.staticInfoURL + getValidatingCompany().logo.image}">
					<span class="nemo-flights-flightInfo__leg__header__text" data-bind="html: $root.i18n('FlightsFlightInfo','leg__header').replace('[%-carrier-%]', getValidatingCompany().name)"></span>
				</div>

				<div class="nemo-flights-flightInfo__leg__route">
					<span class="nemo-flights-flightInfo__leg__route__departue" data-bind="text: legs[$parent.leg].depAirp.name">
					</span><span class="nemo-flights-flightInfo__leg__route__arrival" data-bind="text: legs[$parent.leg].arrAirp.name">
					</span><span class="nemo-flights-flightInfo__leg__route__date" data-bind="text: legs[$parent.leg].depDateTime.getDate() + ' ' + legs[$parent.leg].depDateTime.getMonthName()"></span>
				</div>

				<div class="nemo-flights-flightInfo__leg__segments" data-bind="foreach: segmentsByLeg[$parent.leg]">
					<!-- ko if: $index() > 0 -->
					<div class="nemo-flights-flightInfo__leg__transfer" data-bind="with: $parent.transfers[$parents[1].leg][$index() - 1]">
						Пересадка
						<span class="nemo-flights-flightInfo__leg__transfer__duration" data-bind="text: duration.readableString()"></span>
						<!-- ko if: arrTerminal != depTerminal -->
						<span class="nemo-flights-flightInfo__leg__transfer__terminalChange">Смена терминала</span>
						<!-- /ko -->
					</div>
					<!-- /ko -->
					<div class="nemo-flights-flightInfo__leg__segment">
						<div class="nemo-flights-flightInfo__leg__segment__departure">
							<div class="nemo-flights-flightInfo__leg__segment__time nemo-flights-flightInfo__leg__segment__time_departure" data-bind="text: depDateTime.getHours() + ':' + depDateTime.getMinutes()"></div>

							<div class="nemo-flights-flightInfo__leg__segment__date nemo-flights-flightInfo__leg__segment___departure" data-bind="text:
									depDateTime.getDate() +
									' ' +
									depDateTime.getMonthName() +
									' ' +
									depDateTime.getYear() +
									', ' +
									depDateTime.getDOWName()
							"></div>

							<div class="nemo-flights-flightInfo__leg__segment__city nemo-flights-flightInfo__leg__segment__city_departure" data-bind="text: depAirp.city.name"></div>

							<div class="nemo-flights-flightInfo__leg__segment__airport nemo-flights-flightInfo__leg__segment__airport_departure">
								<span class="nemo-flights-flightInfo__leg__segment__airport__title">
									Аэропорт
								</span>
								<span class="nemo-flights-flightInfo__leg__segment__airport__value" data-bind="text: depAirp.name"></span>
							</div>

							<!-- ko if: depTerminal -->
							<div class="nemo-flights-flightInfo__leg__segment__terminal nemo-flights-flightInfo__leg__segment__terminal_departure">
								<span class="nemo-flights-flightInfo__leg__segment__terminal__title">
									Терминал
								</span>
								<span class="nemo-flights-flightInfo__leg__segment__terminal__value" data-bind="text: depAirp.depTerminal"></span>
							</div>
							<!-- /ko -->
						</div>
						<div class="nemo-flights-flightInfo__leg__segment__arrival">
							<div class="nemo-flights-flightInfo__leg__segment__time nemo-flights-flightInfo__leg__segment__time_arrival" data-bind="text: arrDateTime.getHours() + ':' + arrDateTime.getMinutes()"></div>

							<div class="nemo-flights-flightInfo__leg__segment__date nemo-flights-flightInfo__leg__segment__date_arrival" data-bind="text:
									arrDateTime.getDate() +
									' ' +
									arrDateTime.getMonthName() +
									' ' +
									arrDateTime.getYear() +
									', ' +
									arrDateTime.getDOWName()
							"></div>

							<div class="nemo-flights-flightInfo__leg__segment__city nemo-flights-flightInfo__leg__segment__city_arrival" data-bind="text: arrAirp.city.name"></div>

							<div class="nemo-flights-flightInfo__leg__segment__airport nemo-flights-flightInfo__leg__segment__airport_arrival">
								<span class="nemo-flights-flightInfo__leg__segment__airport__title">
									Аэропорт
								</span>
								<span class="nemo-flights-flightInfo__leg__segment__airport__value" data-bind="text: arrAirp.name"></span>
							</div>

							<!-- ko if: arrTerminal -->
							<div class="nemo-flights-flightInfo__leg__segment__terminal nemo-flights-flightInfo__leg__segment__terminal_arrival">
								<span class="nemo-flights-flightInfo__leg__segment__terminal__title">
									Терминал
								</span>
								<span class="nemo-flights-flightInfo__leg__segment__terminal__value" data-bind="text: arrAirp.arrTerminal"></span>
							</div>
							<!-- /ko -->
						</div>
						<div class="nemo-flights-flightInfo__leg__segment__additional">
							<div class="nemo-flights-flightInfo__leg__segment__additional__item nemo-flights-flightInfo__leg__segment__additional__item_carrier">
								<div class="nemo-flights-flightInfo__leg__segment__additional__item__title">
									Выполняет
								</div><div class="nemo-flights-flightInfo__leg__segment__additional__item__value" data-bind="text: operatingCompany.name,
								css: {'nemo-flights-flightInfo__leg__segment__additional__item__value_warning': operatingCompany.IATA != $parent.getValidatingCompany().IATA}"></div>
							</div>

							<div class="nemo-flights-flightInfo__leg__segment__additional__item nemo-flights-flightInfo__leg__segment__additional__item_flightNumber">
								<div class="nemo-flights-flightInfo__leg__segment__additional__item__title">
									Рейс
								</div><div class="nemo-flights-flightInfo__leg__segment__additional__item__value" data-bind="text: operatingCompany.IATA + ' ' + flightNumber"></div>
							</div>

							<div class="nemo-flights-flightInfo__leg__segment__additional__item nemo-flights-flightInfo__leg__segment__additional__item_class"
							     data-bind="with: $parent.legs[$parents[1].leg].classes[$index()]">
								<div class="nemo-flights-flightInfo__leg__segment__additional__item__title">
									Класс
								</div><div class="nemo-flights-flightInfo__leg__segment__additional__item__value" data-bind="text: $root.i18n('FlightsFlightInfo', 'serviceClass_' + serviceClass) + ' (' + bookingClass + ')'"></div>
							</div>

							<!-- ko if: aircraftType -->
							<div class="nemo-flights-flightInfo__leg__segment__additional__item nemo-flights-flightInfo__leg__segment__additional__item_aircraft">
								<div class="nemo-flights-flightInfo__leg__segment__additional__item__title">
									Самолет
								</div><div class="nemo-flights-flightInfo__leg__segment__additional__item__value" data-bind="text: aircraftType.name"></div>
							</div>
							<!-- /ko -->

							<!--<div class="nemo-flights-flightInfo__leg__segment__additional__item nemo-flights-flightInfo__leg__segment__additional__item_luggage"-->
							     <!--data-bind="with: $parent.legs[$parents[1].leg].classes[$index()]">-->
								<!--<div class="nemo-flights-flightInfo__leg__segment__additional__item__title">-->
									<!--Багаж-->
								<!--</div><div class="nemo-flights-flightInfo__leg__segment__additional__item__value" data-bind="text: $root.i18n('FlightsFlightInfo', 'serviceClass_' + serviceClass) + ' (' + bookingClass + ')'"></div>-->
							<!--</div>-->
						</div>
					</div>
				</div>

				<div class="nemo-flights-flightInfo__leg__footer">
					<div class="nemo-flights-flightInfo__leg__footer__item nemo-flights-flightInfo__leg__footer__item_timeEnRoute">
						<span class="nemo-flights-flightInfo__leg__footer__item__title">
							В пути
						</span>
						<span class="nemo-flights-flightInfo__leg__footer__item__value" data-bind="text: legs[$parent.leg].timeEnRoute.readableString()"></span>
					</div>
				</div>
			</div>
		</div>
	</script>

	<!-- Dates matrix template -->
	<script id="nemo-koTemplate-FlightsResults-DatesMatrix" type="text/html">
		<div class="new-ui-subContainer nemo-flights-results__matrix">
			<table class="nemo-flights-results__matrix__table js-flights-results__matrix" data-bind="flightsResultsMatrixHilighter">
				<tr class="nemo-flights-results__matrix__table__row nemo-flights-results__matrix__table__row_header js-flights-results__matrix__row" data-bind="foreach: matrixData[0]">
					<!-- ko if: $index() == 0 -->
					<th class="nemo-flights-results__matrix__table__header nemo-flights-results__matrix__table__header__corner js-flights-results__matrix__row__cell">
						<div class="nemo-flights-results__matrix__table__corner__rowTitle">
							Обратно
						</div>
						<div class="nemo-flights-results__matrix__table__corner__columnTitle">
							Туда
						</div>
					</th>
					<!-- /ko -->
					<th class="nemo-flights-results__matrix__table__header nemo-flights-results__matrix__table__header_return js-flights-results__matrix__row__cell"
					    data-bind="
							css: {
								'nemo-flights-results__matrix__table__header_originalDate': $index() == 3
							}
					">
						<div class="nemo-flights-results__matrix__table__header__date" data-bind="text: returndate.getDate() + '.' + returndate.getMonth() + '.' + returndate.getYear()"></div>
						<div class="nemo-flights-results__matrix__table__header__DOW" data-bind="text: returndate.getDOWName()"></div>
					</th>
				</tr>

				<tbody data-bind="foreach: matrixData">
					<tr class="nemo-flights-results__matrix__table__row js-flights-results__matrix__row" data-bind="foreach: $data">
						<!-- ko if: $index() == 0 -->
						<th class="nemo-flights-results__matrix__table__header nemo-flights-results__matrix__table__header_forth js-flights-results__matrix__row__cell"
					        data-bind="
								css: {
									'nemo-flights-results__matrix__table__header_originalDate': $parentContext.$index() == 3
								}
						">
							<div class="nemo-flights-results__matrix__table__header__date" data-bind="text: date.getDate() + '.' + date.getMonth() + '.' + date.getYear()"></div>
							<div class="nemo-flights-results__matrix__table__header__DOW" data-bind="text: date.getDOWName()"></div>
						</th>
						<!-- /ko -->
						<td class="nemo-flights-results__matrix__table__cell js-flights-results__matrix__row__cell js-flights-results__matrix__row__cell_target"
							data-bind="
								css: {
									'nemo-flights-results__matrix__table__cell_empty': !price || !company,
									'nemo-flights-results__matrix__table__cell_impossible': date.getTimestamp() > returndate.getTimestamp()
								}
						">
							<!-- ko if: !price && date.getTimestamp() <= returndate.getTimestamp() -->
							<div class="nemo-flights-results__matrix__table__cell__emptyText">Нет перелетов</div>
							<!-- /ko -->
							<!-- ko if: date.getTimestamp() > returndate.getTimestamp() -->
							<div class="nemo-flights-results__matrix__table__cell__impossibleText">&mdash;</div>
							<!-- /ko -->
							<!-- ko if: price && company -->
							<div class="nemo-flights-results__matrix__table__cell__company" data-bind="text: company.name"></div>
							<price class="nemo-flights-results__matrix__table__cell__price" data-bind="money: price"></price>
							<!-- /ko -->
						</td>
					</tr>
				</tbody>

			</table>
		</div>
	</script>

	<script id="nemo-koTemplate-FlightsResults-PostFilters" type="text/html">
		<!--FILTERS-->

        <div class="nemo-common-postFilters__inner">
            <div class="nemo-common-postFilters__notification">
                Найти нужный билет — быстро и просто. Пользуйтесь постфильтрами!
                <div class="nemo-common-postFilters__notification__close"></div>
            </div>

            <!-- ko if: postFiltersHaveValue() -->
            <div class="nemo-common-postFilters__clearAll">
                <div data-bind="click: PFClearAll" class="new-ui-button new-ui-button_common nemo-common-postFilters__clearAll__button">Сбросить все фильтры</div>
            </div>
            <!-- /ko -->

            <div class="nemo-common-postFilters__filterList" data-bind="foreach: visiblePostFilters">
                <!-- Postfilter as-is -->

                <!-- ko if: typeof isActive == 'function' && isActive() -->
                <div class="nemo-common-postFilters__filterList__filter">

                    <div class="nemo-common-postFilters__filterList__filter__caption">
                        <h4 class="nemo-common-postFilters__filterList__filter__caption__name" data-bind="text: $root.i18n('FlightsSearchResults', 'PF__name_' + config.name)"></h4>

                        <!-- ko if: hasValue -->
                        <span data-bind="click: clear" class="new-ui-pseudoLink nemo-common-postFilters__filterList__filter__caption__clear">сбросить</span>
                        <!-- /ko -->
                    </div>


                    <!-- ko if: config.isLegged -->
                        <span class="nemo-common-postFilters__filterList__filter__caption nemo-common-postFilters__filterList__filter__caption_inner">
                            <h5 class="nemo-common-postFilters__filterList__filter__caption__name" data-bind="with: $parent.searchInfo.segments[config.legNumber]">
                                <!-- ko text: departure.name + ' — ' + arrival.name + ' ' + departureDate.getDate() + ' ' + departureDate.getMonthName() --><!-- /ko -->
                            </h5>
                        </span>
                    <!-- /ko -->

                    <!-- ko if: config.type == 'Number' -->
                    <div class="nemo-common-postFilters__filterList__filter__valuesBlock nemo-common-postFilters__filterList__filter__valuesBlock_slider">
                        <div class="nemo-common-postFilters__filterList__filter__valuesBlock__values">
                            <div class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value nemo-common-postFilters__filterList__filter__valuesBlock__values__value_noFlex">

                                <div class="nemo-ui-slider__info">
	                                <!-- ko if: config.name == 'price' -->
	                                <money class="nemo-ui-slider__info__block nemo-ui-slider__info__block_min" data-bind="money: displayValues.min" format="0,0 $"></money>
	                                <span class="nemo-ui-slider__info__block nemo-ui-slider__info__block_divider">—</span>
	                                <money class="nemo-ui-slider__info__block nemo-ui-slider__info__block_max" data-bind="money: displayValues.max" format="0,0 $"></money>
	                                <!-- /ko -->
	                                <!-- ko if: config.name == 'timeEnRoute' || config.name == 'transfersDuration' -->
	                                <span class="nemo-ui-slider__info__block nemo-ui-slider__info__block_min" data-bind="text: displayValues.min.readableStringShortNoSeconds()"></span>
	                                <span class="nemo-ui-slider__info__block nemo-ui-slider__info__block_divider">—</span>
	                                <span class="nemo-ui-slider__info__block nemo-ui-slider__info__block_max" data-bind="text: displayValues.max.readableStringShortNoSeconds()"></span>
	                                <!-- /ko -->
                                </div>

                                <div class="nemo-ui-slider__wrapper">
                                    <div class="nemo-ui-slider" data-bind="flightsResultsPFNumberSlider: value"></div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- /ko -->


                    <!-- ko if: config.type == 'String' -->
                    <div class="nemo-common-postFilters__filterList__filter__valuesBlock">
                        <div class="nemo-common-postFilters__filterList__filter__valuesBlock__values">
                            <div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-PF-String', data: $data }"></div>
                        </div>
                    </div>
                    <!-- /ko -->

                </div>
                <!-- /ko-->

                <!-- Postfilter group -->
                <!-- ko if: typeof isActive != 'function'  -->
                <div class="nemo-common-postFilters__filterList__filter">

                    <div class="nemo-common-postFilters__filterList__filter__caption">
                        <h4 class="nemo-common-postFilters__filterList__filter__caption__name" data-bind="text: $root.i18n('FlightsSearchResults', 'PF__name_' + config.name)"></h4>

                        <!-- ko if: filters.length > 1 -->

                        <span data-bind="click: clear, visible: value()" class="new-ui-pseudoLink nemo-common-postFilters__filterList__filter__caption__clear">сбросить</span>

                        <!-- /ko -->

                    </div>

                    <!-- ko if: filters.length > 1 -->

                    <div class="nemo-common-postFilters__filterList__filter__partSelector">


                        <div class="nemo-common-postFilters__filterList__filter__partSelector__part"
                             data-bind="click: function () {activeFilter(-1);},
                                                css: {
                                                   'nemo-common-postFilters__filterList__filter__partSelector__part_selected': activeFilter() == -1
                                                }">
                            ALL
                        </div>

                        <!-- ko foreach: filters -->
                        <div class="nemo-common-postFilters__filterList__filter__partSelector__part"
                             data-bind="click: function () {$parent.activeFilter($index());},
                                                css: {
                                                   'nemo-common-postFilters__filterList__filter__partSelector__part_hasChanges': hasValue(),
                                                   'nemo-common-postFilters__filterList__filter__partSelector__part_selected': $index() == $parent.activeFilter()
                                                }">
                            Leg: <!-- ko text: config.legNumber --><!-- /ko -->
                        </div>
                        <!-- /ko-->

                    </div>

                    <!-- /ko -->

                    <div class="nemo-common-postFilters__filterList__filter__valuesBlock">

                        <!-- ko if: filters.length > 1 -->
                        <div class="nemo-common-postFilters__filterList__filter__valuesBlock__values"
                             data-bind="visible: activeFilter() == -1">
                            <div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-PF-String', data: $data }"></div>
                        </div>
                        <!-- /ko -->

                        <!-- ko foreach: filters -->
                        <div class="nemo-common-postFilters__filterList__filter__valuesBlock__values"
                             data-bind="visible: $index() == $parent.activeFilter()">
                            <div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-PF-String', data: $data }"></div>
                        </div>
                        <!-- /ko-->

                    </div>

                </div>
                <!-- /ko-->
            </div>
        </div>
	</script>

</div>
