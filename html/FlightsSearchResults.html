<!--<div data-bind="component: {name: 'Common/BreadCrumbs/Controller',params: {-->
		<!--component: $data-->
	<!--}}"></div>-->

<!-- ko if: !$$loading() && !$$error() -->
<div data-bind="foreach: searchInfo.segments" style="border: 1px solid;margin-bottom: 20px;">
	<div data-bind="text: departure.IATA +' - '+arrival.IATA+' '+departureDate.getISODate()"></div>
</div>

<button class="new-ui-button" data-bind="click: function () {formActive(!formActive())}">FORM</button>

<div class="" data-bind="
		component: {
            name: 'Flights/SearchForm/Controller',
			params: {route: [], formData: $$rawdata}
		},
		attr: {
			style: !formActive() ? 'display: none;' : ''
		}
		">
	Loading component...
</div>

<!-- PF TEMPLATES -->
<script id="nemo-koTemplate-FlightsResults-PF-String" type="text/html">
	<!-- ko foreach: values -->
	<div>
		<label>
			<input data-bind="attr: {
								value: key,
								type: $parent.type == 'singleChoice' ? 'radio' : 'checkbox',
								disabled: count() == 0
							},
							checked: $parent.value">
				<span data-bind="text:
					($parent.config.name == 'carrier' || $parent.config.name == 'departureAirport' || $parent.config.name == 'arrivalAirport' ? value.name : value)
				"></span>
			<span data-bind="text:'(' + count() + ')'"></span>
			<span data-bind="text: addValue() ? '(' + addValue().normalizedAmount() + ' ' + addValue().currency() + ')' : ''"></span>
		</label>
	</div>
	<!-- /ko -->
</script>
<script id="nemo-koTemplate-FlightsResults-Group" type="text/html">
	<!-- ko if: !filteredOut() -->
	<div style="margin: 10px;padding: 10px;border: 1px solid;">
		<strong data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency() + ' ' + (filteredOut() ? '-' : '+')"></strong>
		<strong data-bind="text: getValidatingCompany().name + ' ' + getValidatingCompany().rating"></strong>
		<div data-bind="foreach: flights">
			<div>
				<span data-bind="text: id"></span>
				<strong data-bind="text: (filteredOut() ? '-' : '+') + '->' + totalTimeTransfers"></strong>
			</div>
		</div>
		<div data-bind="foreach: legGroupings">
			<div style="display: inline-block;vertical-align: top;width: 33%;">
				<div data-bind="text: selected().flights.join(', ')"></div>
				<select
						style="width: 90%;"
						data-bind="
								options: options,
								value: selected,
								optionsText: function (item) {return $parent.getSelectedFlightsData(item, $index())},
								optionsAfterRender: setOptionDisable
							"
						></select>
			</div>
		</div>
		<div>
			<!-- ko if: selectedFlightsIds().length -->
			<strong data-bind="text: selectedFlightsIds().join(', ')"></strong>
			<button data-bind="
						click: function () {$parent.bookFlight(selectedFlightsIds());},
						text: 'Buy for '+getTotalPrice().normalizedAmount()+' '+getTotalPrice().currency()
						"></button>
			<!-- /ko -->
			<!-- ko if: !selectedFlightsIds().length -->
			<strong>--- NO COMBINABLE FLIGHTS ---</strong>
			<!-- /ko -->
		</div>
		<div>
			Duration on leg: <strong data-bind="text: durationOnLeg"></strong>
		</div>
		<div>
			RecommendRating: <strong data-bind="text: recommendRating"></strong>
		</div>
		<!-- ko if: couplingTable && couplingTable.isActive-->
		<button data-bind="click: function () {couplingTableOpen(true);}">Coupling table: <!-- ko text: couplingTable.flights.length --><!-- /ko --></button>
		<!-- ko if: couplingTableOpen -->
		<div data-bind="with: couplingTable">
			<hr>
			<strong data-bind="text: selectedFlightsIds().join(', ') || '---'"></strong>
			<div data-bind="foreach: sortTypes">
				<div data-bind="
									text: $data, attr:{style: ($data == $parent.sort() ? 'border: 1px solid red;' : '') + 'display: inline-block;padding: 10px;'},
									click: function () {$parent.sort($data);}
								"></div>
			</div>
			<div data-bind="foreach: legGroupings">
				<div data-bind="
									attr: {style: (legActive() ? 'border: 1px solid #000;' : 'border: 1px solid #fff;') + 'display: inline-block;vertical-align: top; padding: 5px;'},
									click: function () {for (var i = 0; i < $parent.legGroupings.length; i++) {$parent.legGroupings[i].legActive(i == $index())}},
									foreach: flights">
					<!-- ko if: $index() == 0 -->
					<div data-bind="text: $parent.selected"></div>
					<!-- /ko -->
					<div data-bind="
										attr: {
											style: 'padding: 5px;border: 1px solid;margin-bottom: 5px;' +
											($data == $parent.selected() ? 'border-color: red;background: #eee;' : '') +
											($parents[1].disabledGroupings[$parentContext.$index()].indexOf($data) >= 0 ? 'opacity: 0.5;' : '')
										},
										click: function () {$parents[1].selectVariant($data, $parentContext.$index())}
									">
						<div data-bind="text: $data.join(', ')"></div>
						<div data-bind="text: $parents[1].flightsById[$data[0]].legs[$parentContext.$index()].depAirp.IATA + ' - ' + $parents[1].flightsById[$data[0]].legs[$parentContext.$index()].arrAirp.IATA"></div>
						<div data-bind="text: $parents[1].flightsById[$data[0]].legs[$parentContext.$index()].depDateTime.getISOTime() + ' - ' + $parents[1].flightsById[$data[0]].legs[$parentContext.$index()].arrDateTime.getISOTime()"></div>
					</div>
				</div>
				<!-- ko if: $index() == ($parent.legGroupings.length - 1) -->
				<div data-bind="
					attr: {style: 'border: 1px solid #fff;display: inline-block;vertical-align: top; padding: 5px;'},
					foreach: flights">
					<!-- ko if: $index() == 0 -->
					<div>buy block</div>
					<!-- /ko -->
					<div data-bind="
						attr: {style: 'padding: 5px;border: 1px solid;margin-bottom: 5px;' + ($data == $parent.selected() ? 'border-color: red;background: #eee;' : '')}
					">
						&nbsp;
						<br/>
						<span class="new-ui-pseudoLink" data-bind="
							click: function () {if ($data != $parent.selected()) {$parents[1].selectVariant($data, $parentContext.$index())}else{$parents[3].bookFlight($parents[1].selectedFlightsIds());}},
							text: 'Buy for '+$parents[1].flightsById[$data[0]].getTotalPrice().normalizedAmount()+' '+$parents[1].flightsById[$data[0]].getTotalPrice().currency()
						"></span>
						<br/>
						&nbsp;
					</div>
				</div>
				<!-- /ko -->
			</div>
		</div>
		<!-- /ko -->
		<!-- /ko -->
	</div>
	<!-- /ko -->
</script>
<h3>Flights table</h3>
<div>
	<div class="pager" data-bind="with: flightsCompareTableTransfer">
		<a href="#" class="previous" data-bind="click: paginationPrev, visible: paginationHasPrev">&lt;</a>
		<span class="all" data-bind="text:$data.groups.length"></span>
		<a href="#" class="previous" data-bind="click: paginationNext, visible: paginationHasNext">&gt;</a>
	</div>
	<div>Transfer Flights</div>
	<div data-bind="foreach: flightsCompareTableTransfer().groups">
		<!-- ko if: !groupsFilteredOut() -->
		<div data-bind="style:{display:$index() >= $parent.flightsCompareTableTransfer().paginationShownPages() && $index() < $parent.flightsCompareTableTransfer().paginationShownPages() + $parent.flightsCompareTableTransfer().paginationStep() ? 'inline-block': 'none'}" style="margin-right: 10px; vertical-align: top">
			<div data-bind="text: company.name"></div>
			<div data-bind="foreach: groups">
				<!-- ko if: !filteredOut() -->
				<div data-bind="visible: ($parents[1].flightsCompareTableTransfer().allGroupsVisible() ? true : $index() < 3)" style="margin: 10px;padding: 10px;border: 1px solid; width: 150px; height: 70px; display: block; overflow: hidden;">
					<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', with: $data }"></div>
				</div>
				<!-- /ko -->
			</div>
		</div>
		<!-- /ko -->
	</div>
	<div data-bind="with: flightsCompareTableTransfer">
		<a data-bind="text:$data.allGroupsVisible() ? 'Show Less' : 'Show More', click:$data.toggleVisibleGroups(), visible:$data.flagToShowMore()"></a>
	</div>
</div>
<div>
	<div class="pager" data-bind="with: flightsCompareTableDirect">
		<a href="#" class="previous" data-bind="click: paginationPrev, visible: paginationHasPrev">&lt;</a>
		<span class="all" data-bind="text:$data.groups.length"></span>
		<a href="#" class="previous" data-bind="click: paginationNext, visible: paginationHasNext">&gt;</a>
	</div>
	<div>Direct Flights</div>
	<div data-bind="foreach: flightsCompareTableDirect().groups">
		<!-- ko if: !groupsFilteredOut() -->
		<div data-bind="style:{display:$index() >= $parent.flightsCompareTableDirect().paginationShownPages() && $index() < $parent.flightsCompareTableDirect().paginationShownPages() + $parent.flightsCompareTableDirect().paginationStep() ? 'inline-block': 'none'}" style="margin-right: 10px; vertical-align: top">
		<div data-bind="text: company.name"></div>
			<div data-bind="foreach: groups">
				<!-- ko if: !filteredOut() -->
					<div data-bind="visible: ($parents[1].flightsCompareTableDirect().allGroupsVisible() ? true : $index() < 3)" style="margin: 10px;padding: 10px;border: 1px solid; width: 150px; height: 70px; display: block; overflow: hidden;">
						<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', with: $data }"></div>
					</div>
				<!-- /ko -->
			</div>
		</div>
		<!-- /ko -->
	</div>
	<div data-bind="with: flightsCompareTableDirect">
		<a data-bind="text:$data.allGroupsVisible() ? 'Show Less' : 'Show More', click:$data.toggleVisibleGroups(), visible:$data.flagToShowMore()"></a>
	</div>
</div>

<div style="padding: 0 420px;position: relative;">
	<!--FILTERES-->
	<div style="border: 1px solid green; position: absolute;top: 0;left: 0;width: 360px;padding: 20px;">
		<h3>
			FILTERS
			<!-- ko if: postFiltersHaveValue() -->
			<span data-bind="click: PFClearAll" class="new-ui-pseudoLink">CLEAR ALL</span>
			<!-- /ko -->
		</h3>
		<div data-bind="foreach: visiblePostFilters">
			<!-- Postfilter as-is -->
			<!-- ko if: typeof isActive == 'function' && isActive() -->
			<div>
				<h4>
					<!-- ko text: config.name --><!-- /ko -->
					<!-- ko if: config.isLegged -->
					<!-- ko text: $parent.searchInfo.segments[config.legNumber].departure.IATA + ' - ' + $parent.searchInfo.segments[config.legNumber].arrival.IATA --><!-- /ko -->
					<!-- /ko -->
					<!-- ko if: hasValue -->
						<span data-bind="click: clear" class="new-ui-pseudoLink">CLEAR</span>
					<!-- /ko -->
				</h4>
				<!-- ko if: config.type == 'Number' -->
					<div data-bind="flightsResultsPFNumberSlider: value"></div>
					<div>
						MIN:
						<!-- ko text: values().min --><!-- /ko -->
					</div>
					<div>
						MAX:
						<!-- ko text: values().max --><!-- /ko -->
					</div>
					<div>
						SELECTED:
						<!-- ko text: value().min --><!-- /ko -->
						-
						<!-- ko text: value().max --><!-- /ko -->
					</div>
				<!-- /ko -->
				<!-- ko if: config.type == 'String' -->
					<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-PF-String', data: $data }"></div>
				<!-- /ko -->
			</div>
			<!-- /ko-->
			<!-- Postfilter group -->
			<!-- ko if: typeof isActive != 'function'  -->
				<h4>PF GROUP <!-- ko text: filters[0].config.name --><!-- /ko --> (<!-- ko text: activeFilter --><!-- /ko -->)</h4>
				<div>
					<!-- ko if: filters.length > 1 -->
					<div class="new-ui-pseudoLink" data-bind="click: function () {activeFilter(-1);}">
						ALL
					</div>
					<!-- /ko -->
					<!-- ko foreach: filters -->
						<div class="new-ui-pseudoLink" data-bind="click: function () {$parent.activeFilter($index());}">
							Leg: <!-- ko text: config.legNumber + ' ' + (hasValue() ? '!!!' : '') --><!-- /ko -->
						</div>
					<!-- /ko-->
				</div>
				<!-- ko if: filters.length > 1 -->
					<div data-bind="attr: {'style': activeFilter() != -1 ? 'display: none;' : ''}">
						Leg: ALL
						<!-- ko if: value() != '' -->
						<span data-bind="click: clear" class="new-ui-pseudoLink">CLEAR</span>
						<!-- /ko -->
						<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-PF-String', data: $data }"></div>
					</div>
				<!-- /ko -->
				<!-- ko foreach: filters -->
					<div data-bind="attr: {'style': $index() != $parent.activeFilter() ? 'display: none;' : ''}">
						Leg: <!-- ko text: config.legNumber --><!-- /ko -->
						<!-- ko if: hasValue -->
							<span data-bind="click: clear" class="new-ui-pseudoLink">CLEAR</span>
						<!-- /ko -->
						<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-PF-String', data: $data }"></div>
					</div>
				<!-- /ko-->
			<!-- /ko-->
		</div>
	</div>

	<div style="border: 1px solid green; position: absolute;top: 0;right: 0;width: 360px;padding: 20px;">
		<h3>BEST COMPANIES</h3>
		<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', foreach: showcase.bestCompanies }"></div>
	</div>

	<!-- ko if: hasVisibleResult() -->
		<h3>SHOWCASE</h3>
		<!-- ko if: showcase.recommended() -->
		<h4>recommended</h4>
		<div style="margin: 10px;padding: 10px;border: 1px solid red;" data-bind="with: showcase.recommended">
			<strong data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency() + ' ' + (filteredOut() ? '-' : '+') + '->' + totalTimeTransfers"></strong>
			<div data-bind="foreach: segments">
				<div data-bind="text: id+' '+depAirp.name+' - '+arrAirp.name+' '+depDateTime.getISODateTime()+' - '+arrDateTime.getISODateTime()"></div>
			</div>
		</div>
		<!-- /ko -->
		<!-- ko if: showcase.cheapest() -->
		<h4>cheapest</h4>
		<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', data: showcase.cheapest }"></div>
		<!-- /ko -->
		<!-- ko if: showcase.fastest() -->
		<h4>fastest</h4>
		<div style="margin: 10px;padding: 10px;border: 1px solid red;" data-bind="with: showcase.fastest">
			<strong data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency() + ' ' + (filteredOut() ? '-' : '+') + '->' + totalTimeTransfers"></strong>
			<div data-bind="foreach: segments">
				<div data-bind="text: id+' '+depAirp.name+' - '+arrAirp.name+' '+depDateTime.getISODateTime()+' - '+arrDateTime.getISODateTime()"></div>
			</div>
		</div>
		<!-- /ko -->
		<h3>RESULTS</h3>
		<h4>
			SORT:
			<select data-bind="options: possibleSorts, value: sort"></select>
		</h4>
		<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', foreach: groups }"></div>
	<!-- /ko -->
	<!-- ko if: !hasVisibleResult() -->
	<h2>FILTERS GIVEN EMPTY RESULT</h2>
	<!-- /ko -->
</div>
<!-- /ko -->

<!-- ko if: $$loading() -->
LOADING
<!-- /ko -->

<!-- ko if: $$error() -->
<div data-bind="text: $$error()"></div>
<!-- /ko -->

<!--<div class="" data-bind="component: {-->
	                <!--name: 'FlightsSearchForm/FlightsSearchFormController',-->
					<!--params: { asdasd: 'asdasdasd' }-->
				<!--}">Loading flights search form...</div>-->