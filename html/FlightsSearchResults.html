<div data-bind="component: {name: 'Common/BreadCrumbs/Controller', params: {
		component: $data,
		includeComponent: {
			name: 'Flights/LastSearches/Controller',
			params: {}
		}
	}}"></div>


<div class="nemo-flights-results">
	<!-- ko if: !$$loading() &&  !$$error() -->
		<!-- Form dummy -->
		<section class="nemo-flights-results__formDummy"  data-bind="attr: {style: formActive() ? 'display: none;' : ''}">
			<div
				data-bind="
					foreach: searchInfo.segments,
					attr: {'class':'nemo-flights-results__formDummy__route nemo-flights-results__formDummy__route_' + searchInfo.tripType}
				">
				<div class="nemo-flights-results__formDummy__route__segment">

					<!-- ko if: $parent.searchInfo.tripType != 'RT' || $index() != 1 -->
						<div class="nemo-flights-results__formDummy__route__segment__geo nemo-flights-results__formDummy__route__segment__geo_departure" data-bind="with: departure">
							<span
								class="nemo-flights-results__formDummy__route__segment__geo__main"
								data-bind="text: name">
							</span><span
								class="nemo-flights-results__formDummy__route__segment__geo__aux"
								data-bind="text: ', ' + (!isCity && city && name != city.name ? city.name + ', ' : '') + country.name"></span>
						</div>
						<div class="nemo-flights-results__formDummy__route__segment__geo nemo-flights-results__formDummy__route__segment__geo_arrival" data-bind="with: arrival">
							<span
								class="nemo-flights-results__formDummy__route__segment__geo__main"
								data-bind="text: name">
							</span><span
								class="nemo-flights-results__formDummy__route__segment__geo__aux"
								data-bind="text: ', ' + (!isCity && city && name != city.name ? city.name + ', ' : '') + country.name"></span>
						</div>
					<!-- /ko -->

					<div class="nemo-flights-results__formDummy__route__segment__date">
						<!-- ko text:
							(
								$parent.searchInfo.tripType == 'RT' ?
								$root.i18n('FlightsSearchResults', 'formDummy__route__rt__' + ($index() == 0 ? 'flight' : 'return')) + ' ' :
								''
							) +
							departureDate.getDate() +
							' ' +
							departureDate.getMonthName() +
							', ' +
							departureDate.getDOWName() --><!-- /ko -->
					</div>
				</div>
			</div>

			<div class="nemo-flights-results__formDummy__passengers" data-bind="text: passengersSummary()"></div>

			<div
				class="new-ui-button nemo-flights-results__formDummy__switch"
				data-bind="text: $root.i18n('FlightsSearchResults', 'formDummy__switch'), click: function () {formActive(!formActive())}"></div>
		</section>

		<!-- Actual form -->
		<section class="nemo-flights-results__form" data-bind="
			component: {
	            name: 'Flights/SearchForm/Controller',
				params: {route: [], formData: $$rawdata}
			},
			attr: {
				style: !formActive() ? 'display: none;' : ''
			}
			"></section>

		<section class="nemo-flights-results__comapreTableOpener">
			<div class="nemo-flights-results__comapreTableOpener__text" data-bind="text: $root.i18n('FlightsSearchResults','compareTableSwitcher_open')"></div>
		</section>
		<div class="nemo-flights-results__compareTable__wrapper"
			 data-bind="compareTableWidth:flightsCompareTableTransfer()">
			<div class="nemo-flights-results__compareTable__inner_hidden js-flights-results__compareTable__inner_hidden"
				 data-bind="foreach: flightsCompareTableTransfer().groups">
				<!-- ko if: !groupsFilteredOut() -->
				<div class="nemo-flights-results__compareTable__groups js-flights-results__compareTable__groups"
					 data-bind="foreach: groups">
					<!-- ko if: !filteredOut() -->
					<div class="nemo-flights-results__compareTable__groupsItem nemo-flights-results__compareTable__groupsItem_hidden js-flights-results__compareTable__groupsItem"
						 data-bind="attr:{'data-flightId':$data.flights[0].id}">
						<!-- ko if: !filteredOut() -->
						<div class="nemo-flights-results__compareTable__groupsItem__shortInfo">
							<div class="nemo-flights-results__compareTable__groupsItem__price"
								  data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency()">
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__duration"
								  data-bind="text: durationOnLegString().readableString() != 0 ? durationOnLegString().readableString() : $root.i18n('FlightsSearchResults', 'flightsCompareTable__unknownFlightTime');">
							</div>
						</div>
						<div class="nemo-flights-results__compareTable__groupsItem__fullInfo">
							<a class="new-ui-pseudoLink nemo-flights-results__compareTable__groupsItem__linkToFullTicket"
							   data-bind="attr{'data-FirstFlightId':$data.flights[0].id}">Go to ticket</a>
							<!--<div data-bind="foreach: flights">-->
							<!--<strong data-bind="text:totalTimeEnRoute.length"></strong>-->
							<!--</div>-->
							<div class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap"
								 data-bind="foreach: legGroupings">
										<span class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap__tip"
											  data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__time')"></span>
								<select style="max-width: 100%"
										data-bind="options: options,
											value: selected,
											optionsText: function (item) {return $parent.getSelectedFlightsData(item, $index())},
									optionsAfterRender: setOptionDisable
									"></select>
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__buttonWrap">
								<!-- ko if: selectedFlightsIds().length -->
								<button class="new-ui-button"
										data-bind="click: function () {$parent.bookFlight(selectedFlightsIds());},
												text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__buy')">
								</button>
								<!-- /ko -->
								<!-- ko if: !selectedFlightsIds().length -->
								<strong>--- NO COMBINABLE FLIGHTS ---</strong>
								<!-- /ko -->
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__disclaimer">
								Цена за всех пассажиров
							</div>
							<div class="nemo-flights-results__compareTable__groupsItem__disclaimer">
								Везде указано метное время
							</div>
						</div>
						<!-- /ko -->
					</div>
					<!-- /ko -->
				</div>
				<!-- /ko -->
			</div>
			<div class="nemo-flights-results__compareTable nemo-flights-results__compareTable_flightsTransfer"
				 data-bind="compareTableWidth:flightsCompareTableTransfer()">
				<div class="nemo-flights-results__compareTable__pager" data-bind="with: flightsCompareTableTransfer">
					<a href="#" class="nemo-flights-results__compareTable__pager__prev"
					   data-bind="click: paginationPrev, style: {'visibility':paginationHasPrev() == true ?'visible':'hidden'}">
						&lt;</a>

					<div class="nemo-flights-results__compareTable__title">Transfer Flights
					<span class="nemo-flights-results__compareTable__pager__allItems"
						  data-bind="text:'('+$data.groups.length+')'"></span>
					</div>
					<a href="#" class="nemo-flights-results__compareTable__pager__next"
					   data-bind="click: paginationNext, style: {'visibility':paginationHasNext() == true ?'visible':'hidden'}">
						&gt;</a>
				</div>
				<div class="nemo-flights-results__compareTable__inner"
					 data-bind="foreach: flightsCompareTableTransfer().groups,
					compareTablePosition:flightsCompareTableTransfer()">
					<!-- ko if: !groupsFilteredOut() -->
					<div class="nemo-flights-results__compareTable__companyColumn js-flights-results__compareTable__companyColumn"
						 data-bind="compareTableVisibleClass:$parents[0].flightsCompareTableTransfer(),null,null,$data">
						<div class="nemo-flights-results__compareTable__companyLogo">
							<div class="nemo-flights-results__compareTable__companyLogo__image" data-bind="style: { backgroundImage: 'url('+$root.controller.options.staticInfoURL+company.logo.icon+')' }"></div>
						 </div>
						<div class="nemo-flights-results__compareTable__groups js-flights-results__compareTable__groups"
							 data-bind="foreach: groups">
							<!-- ko if: !filteredOut() -->
							<div class="nemo-flights-results__compareTable__groupsItem  nemo-flights-results__compareTable__groupsItem_minimized js-flights-results__compareTable__groupsItem"
								 data-bind="visible:($parents[1].flightsCompareTableTransfer().allGroupsVisible()
								&&
								$($element).parents('.js-flights-results__compareTable__companyColumn').hasClass('js-flights-results__compareTable__companyColumn_visible')) ? true : $index() < 2,
								compareTableCloneCell:null,
								attr:{'data-flightId':$data.flights[0].id}">
								<!-- ko if: !filteredOut() -->
								<div class="nemo-flights-results__compareTable__groupsItem__shortInfo">
									<div class="nemo-flights-results__compareTable__groupsItem__price"
										 data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency()">
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__duration"
										 data-bind="text: durationOnLegString().readableString() != 0 ? durationOnLegString().readableString() : $root.i18n('FlightsSearchResults', 'flightsCompareTable__unknownFlightTime');">
									</div>
								</div>
								<div class="nemo-flights-results__compareTable__groupsItem__fullInfo">
									<a class="new-ui-pseudoLink nemo-flights-results__compareTable__groupsItem__linkToFullTicket">Go
										to ticket</a>
									<!--<div data-bind="foreach: flights">-->
									<!--<strong data-bind="text:totalTimeEnRoute.length"></strong>-->
									<!--</div>-->
									<div class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap"
										 data-bind="foreach: legGroupings">
										<span class="nemo-flights-results__compareTable__groupsItem__flightSelectWrap__tip"
												data-bind="text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__time')"></span>
										<select style="max-width: 100%"
												data-bind="
													options: options,
															value: selected,
															optionsText: function (item) {return $parent.getSelectedFlightsData(item, $index())},
													optionsAfterRender: setOptionDisable
													"></select>
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__buttonWrap">
										<!-- ko if: selectedFlightsIds().length -->
										<button class="new-ui-button"
												data-bind="click: function () {$parent.bookFlight(selectedFlightsIds());},
												text:$root.i18n('FlightsSearchResults', 'flightsCompareTable__buy')">
										</button>
										<!-- /ko -->
										<!-- ko if: !selectedFlightsIds().length -->
										<strong>--- NO COMBINABLE FLIGHTS ---</strong>
										<!-- /ko -->
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__disclaimer">
										Цена за всех пассажиров
									</div>
									<div class="nemo-flights-results__compareTable__groupsItem__disclaimer">
										Везде указано местное время
									</div>
								</div>
								<!-- /ko -->
							</div>
							<!-- /ko -->
						</div>
					</div>
					<!-- /ko -->
				</div>
			</div>
			<div class="nemo-flights-results__compareTable__showMore__container" data-bind="with: flightsCompareTableTransfer">
				<a class="nemo-flights-results__compareTable__showMore__switch"
				   data-bind="text:$data.allGroupsVisible() ? 'Show Less' : 'Show More', click:$data.toggleVisibleGroups(), visible:$data.flagToShowMore()"></a>
			</div>
		</div>
		<section class="nemo-flights-results__content">
			<aside class="nemo-flights-results__content__postfilters">
                <!--FILTERES-->
                <div class="nemo-common-postFilters" >

                    <div class="nemo-common-postFilters__notification">
                        Найти нужный билет — быстро и просто. Пользуйтесь постфильтрами!
                        <div class="nemo-common-postFilters__notification__close"></div>
                    </div>

                    <div class="nemo-common-postFilters__clearAll">
                        <!-- ko if: postFiltersHaveValue() -->
                        <div data-bind="click: PFClearAll" class="new-ui-button new-ui-button_secondary nemo-common-postFilters__clearAll__button">Сбросить все фильтры</div>
                        <!-- /ko -->
                    </div>

                    <div class="nemo-common-postFilters__filterList" data-bind="foreach: visiblePostFilters">
                        <!-- Postfilter as-is -->

                        <!-- ko if: typeof isActive == 'function' && isActive() -->
                        <div class="nemo-common-postFilters__filterList__filter">

                            <div class="nemo-common-postFilters__filterList__filter__caption">
                                <h4 class="nemo-common-postFilters__filterList__filter__caption__name">
                                    <!-- ko text: config.name --><!-- /ko -->
                                </h4>

                                <!-- ko if: hasValue -->
                                <span data-bind="click: clear" class="new-ui-pseudoLink nemo-common-postFilters__filterList__filter__caption__clear">сбросить</span>
                                <!-- /ko -->
                            </div>


                            <!-- ko if: config.isLegged -->
                    <span class="nemo-common-postFilters__filterList__filter__caption nemo-common-postFilters__filterList__filter__caption_inner">
                        <h5 class="nemo-common-postFilters__filterList__filter__caption__name">
                            <!-- ko text: $parent.searchInfo.segments[config.legNumber].departure.IATA + ' - ' + $parent.searchInfo.segments[config.legNumber].arrival.IATA --><!-- /ko -->
                        </h5>
                    </span>
                            <!-- /ko -->

                            <!-- ko if: config.type == 'Number' -->
                            <div data-bind="flightsResultsPFNumberSlider: value"></div>
                            <div>
                                MIN:
                                <!-- ko text: values().min --><!-- /ko -->
                            </div>
                            <div>
                                MAX:
                                <!-- ko text: values().max --><!-- /ko -->
                            </div>
                            <div>
                                SELECTED:
                                <!-- ko text: value().min --><!-- /ko -->
                                -
                                <!-- ko text: value().max --><!-- /ko -->
                            </div>
                            <!-- /ko -->


                            <!-- ko if: config.type == 'String' -->
                            <div class="nemo-common-postFilters__filterList__filter__valuesBlock__values">
                                <div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-PF-String', data: $data }"></div>
                            </div>
                            <!-- /ko -->

                        </div>
                        <!-- /ko-->

                        <!-- Postfilter group -->
                        <!-- ko if: typeof isActive != 'function'  -->
                        <div class="nemo-common-postFilters__filterList__filter">

                            <div class="nemo-common-postFilters__filterList__filter__caption">
                                <h4 class="nemo-common-postFilters__filterList__filter__caption__name">
                                    <!-- ko text: filters[0].config.name --><!-- /ko -->
                                </h4>

                                <!-- ko if: filters.length > 1 -->

                                <span data-bind="click: clear, visible: value()" class="new-ui-pseudoLink nemo-common-postFilters__filterList__filter__caption__clear">сбросить</span>

                                <!-- /ko -->

                            </div>

                            <div class="nemo-common-postFilters__filterList__filter__partSelector">

                                <!-- ko if: filters.length > 1 -->
                                <div class="nemo-common-postFilters__filterList__filter__partSelector__part"
                                     data-bind="click: function () {activeFilter(-1);},
                             css: {
                                'nemo-common-postFilters__filterList__filter__partSelector__part_selected': activeFilter() == -1
                             }">
                                    ALL
                                </div>
                                <!-- /ko -->

                                <!-- ko foreach: filters -->
                                <div class="nemo-common-postFilters__filterList__filter__partSelector__part"
                                     data-bind="click: function () {$parent.activeFilter($index());},
                             css: {
                                'nemo-common-postFilters__filterList__filter__partSelector__part_hasChanges': hasValue(),
                                'nemo-common-postFilters__filterList__filter__partSelector__part_selected': $index() == $parent.activeFilter()
                            }">
                                    Leg: <!-- ko text: config.legNumber --><!-- /ko -->
                                </div>
                                <!-- /ko-->

                            </div>

                            <div class="nemo-common-postFilters__filterList__filter__valuesBlock">


                                <!-- ko if: filters.length > 1 -->
                                <div class="nemo-common-postFilters__filterList__filter__valuesBlock__values"
                                     data-bind="click: clear">
                                    Все равно
                                </div>
                                <!-- /ko -->

                                <!-- ko if: filters.length > 1 -->
                                <div class="nemo-common-postFilters__filterList__filter__valuesBlock__values"
                                     data-bind="visible: activeFilter() == -1">
                                    <div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-PF-String', data: $data }"></div>
                                </div>
                                <!-- /ko -->

                                <!-- ko foreach: filters -->
                                <div class="nemo-common-postFilters__filterList__filter__valuesBlock__values"
                                     data-bind="visible: $index() == $parent.activeFilter()">
                                    <div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-PF-String', data: $data }"></div>
                                </div>
                                <!-- /ko-->

                            </div>

                        </div>
                        <!-- /ko-->
                    </div>
                </div>
			</aside>

			<section class="new-ui-subContainer nemo-flights-results__content__results">
				<!-- ko if: hasVisibleResult() -->
					<div class="nemo-flights-results__showcase">
						<!-- ko if: showcase.recommended() -->
							<!-- ko with: {group: showcase.fastest(), modifier: 'recommended'} -->
							<div class="nemo-flights-results__showcase__item nemo-flights-results__showcase__item_recommended"
							     data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', data: group }"></div>
							<!-- /ko -->
						<!-- /ko -->

						<!-- ko if: showcase.fastest() -->
							<!-- ko with: {group: showcase.fastest(), modifier: 'fastest'} -->
							<div class="nemo-flights-results__showcase__item nemo-flights-results__showcase__item_fastest"
							     data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', data: group }"></div>
							<!-- /ko -->
						<!-- /ko -->

						<!-- ko if: showcase.cheapest() -->
						<!-- ko with: {group: showcase.cheapest(), modifier: 'cheapest'} -->
						<div class="nemo-flights-results__showcase__item nemo-flights-results__showcase__item_cheapest"
						     data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', data: group }"></div>
						<!-- /ko -->
						<!-- /ko -->
					</div>
				<!-- /ko -->
				<select data-bind="options: possibleSorts, value: sort"></select>

				<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', foreach: groups }"></div>

				<!-- ko if: !hasVisibleResult() -->
				<h2>FILTERS GIVEN EMPTY RESULT</h2>
				<!-- /ko -->
			</section>

			<aside class="nemo-flights-results__content__offers">
				<h3>BEST COMPANIES</h3>
				<!-- ko with: {groups: showcase.bestCompanies, modifier: 'bestCompanies'} -->
					<div data-bind="template: { name: 'nemo-koTemplate-FlightsResults-Group', foreach: groups }"></div>
				<!-- /ko -->
			</aside>
		</section>
	<!-- /ko -->

	<!-- ko if: $$loading -->
	<div class="new-ui-subContainer nemo-flights-results__loader"></div>
	<!-- /ko -->

	<!-- ko if: $$error -->
	<div class="new-ui-subContainer nemo-flights-results__error" data-bind="text: $$error() + console.log($$error())"></div>
	<!-- /ko -->

	<!-- PF TEMPLATES -->
    <script id="nemo-koTemplate-FlightsResults-PF-String" type="text/html">

        <!-- ko foreach: values -->
        <label class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value"
               data-bind="css: {
                    'nemo-common-postFilters__filterList__filter__valuesBlock__values__value_disabled' : count() == 0,
                    'nemo-common-postFilters__filterList__filter__valuesBlock__values__value_checked' : $parent.value() instanceof Array ? $parent.value().indexOf(key) >= 0 : $parent.value() == key
                }">

            <input class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value__input"
                   data-bind="attr: {
								value: key,
								type: $parent.type == 'singleChoice' ? 'radio' : 'checkbox',
								disabled: count() == 0
							},
							checked: $parent.value">

            <span class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value__name"
                  data-bind="text: ($parent.config.name == 'carrier' || $parent.config.name == 'departureAirport' || $parent.config.name == 'arrivalAirport' ? value.name : value)
            "></span>

            <span class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value__price" data-bind="text: addValue() ? 'от ' + addValue().normalizedAmount() + ' ' + addValue().currency() : ''">
                <!-- ko if: addValue() --><!-- /ko -->
            </span>

            <span class="nemo-common-postFilters__filterList__filter__valuesBlock__values__value__quantity" data-bind="text: count() "></span>
        </label>
        <!-- /ko -->

    </script>

	<!-- Flights group -->
	<script id="nemo-koTemplate-FlightsResults-Group" type="text/html">
		<!-- ko if: !filteredOut() -->
		<!-- TODO add carrier coloring here -->
		<div data-bind="attr: {'class': 'new-ui-subContainer nemo-flights-results__flightsGroup ' + ($parent.modifier ? 'nemo-flights-results__flightsGroup_' + $parent.modifier : '')}">
			<div class="new-ui-subContainer__header nemo-flights-results__flightsGroup__header">
				<div class="nemo-flights-results__flightsGroup__header__title">
					<div class="nemo-flights-results__flightsGroup__header__title__ffEllipsisHack__outer">
						<div class="nemo-flights-results__flightsGroup__header__title__ffEllipsisHack__inner" data-bind="text: $parent.modifier && $parent.modifier != 'bestCompanies' ? $root.i18n('FlightsSearchResults', 'flightsGroup__header_' + $parent.modifier) : getValidatingCompany().name"></div>
					</div>
				</div>
				<div class="nemo-flights-results__flightsGroup__header__additional">
					<div class="nemo-flights-results__flightsGroup__rating nemo-flights-results__flightsGroup__rating_inHeader" data-bind="foreach: getValidatingCompany().ratingItems"><!--
						--><div class="nemo-flights-results__flightsGroup__rating__item" data-bind="css:{'nemo-flights-results__flightsGroup__rating__item_active': $data}"></div><!--
					--></div><!--
					--><img class="nemo-flights-results__flightsGroup__header__logo"
					     data-bind="attr: {src: $root.controller.options.staticInfoURL + getValidatingCompany().logo.image}"><!--
					     ko if: carriersMismatch
				    --><div class="nemo-flights-results__flightsGroup__header__info" data-bind=""></div>
					<!-- /ko -->
				</div>
			</div>

			<div class="nemo-flights-results__flightsGroup__subHeader">
				<div class="nemo-flights-results__flightsGroup__subHeader__title">
					Рейтинг авиакомпании
				</div>

				<div class="nemo-flights-results__flightsGroup__subHeader__additional">
					<div class="nemo-flights-results__flightsGroup__rating nemo-flights-results__flightsGroup__rating_inSubHeader" data-bind="foreach: getValidatingCompany().ratingItems"><!--
						--><div class="nemo-flights-results__flightsGroup__rating__item" data-bind="css:{'nemo-flights-results__flightsGroup__rating__item_active': $data}"></div><!--
					--></div>
				</div>
			</div>

			<div data-bind="text: $parent.modifier"></div>
			<strong data-bind="text: getTotalPrice().normalizedAmount() + ' ' + getTotalPrice().currency() + ' ' + (filteredOut() ? '-' : '+')"></strong>
			<strong data-bind="text: getValidatingCompany().name + ' ' + getValidatingCompany().rating"></strong>
			<!--<div data-bind="foreach: flights">-->
				<!--<div>-->
					<!--<span data-bind="text: id"></span>-->
					<!--<strong data-bind="text: (filteredOut() ? '-' : '+') + '->' + totalTimeTransfers"></strong>-->
				<!--</div>-->
			<!--</div>-->
			<div data-bind="foreach: legGroupings">
				<div style="display: inline-block;vertical-align: top;width: 33%;">
					<div data-bind="text: selected().flights.join(', ')"></div>
					<select
							style="width: 90%;"
							data-bind="
										options: options,
										value: selected,
										optionsText: function (item) {return $parent.getSelectedFlightsData(item, $index())},
										optionsAfterRender: setOptionDisable
									"
							></select>
				</div>
			</div>
			<div>
				<!-- ko if: selectedFlightsIds().length -->
				<strong data-bind="text: selectedFlightsIds().join(', ')"></strong>
				<button data-bind="
								click: function () {$parent.bookFlight(selectedFlightsIds());},
								text: 'Buy for '+getTotalPrice().normalizedAmount()+' '+getTotalPrice().currency()
								"></button>
				<!-- /ko -->
				<!-- ko if: !selectedFlightsIds().length -->
				<strong>--- NO COMBINABLE FLIGHTS ---</strong>
				<!-- /ko -->
			</div>
			<div>
				Duration on leg: <strong data-bind="text: durationOnLeg"></strong>
			</div>
			<div>
				RecommendRating: <strong data-bind="text: recommendRating"></strong>
			</div>
			<!-- ko if: couplingTable && couplingTable.isActive-->
			<button data-bind="click: function () {couplingTableOpen(true);}">Coupling table: <!-- ko text: couplingTable.flights.length --><!-- /ko --></button>
			<!-- ko if: couplingTableOpen -->
			<div data-bind="with: couplingTable">
				<hr>
				<strong data-bind="text: selectedFlightsIds().join(', ') || '---'"></strong>
				<div data-bind="foreach: sortTypes">
					<div data-bind="
											text: $data, attr:{style: ($data == $parent.sort() ? 'border: 1px solid red;' : '') + 'display: inline-block;padding: 10px;'},
											click: function () {$parent.sort($data);}
										"></div>
				</div>
				<div data-bind="foreach: legGroupings">
					<div data-bind="
											attr: {style: (legActive() ? 'border: 1px solid #000;' : 'border: 1px solid #fff;') + 'display: inline-block;vertical-align: top; padding: 5px;'},
											click: function () {for (var i = 0; i < $parent.legGroupings.length; i++) {$parent.legGroupings[i].legActive(i == $index())}},
											foreach: flights">
						<!-- ko if: $index() == 0 -->
						<div data-bind="text: $parent.selected"></div>
						<!-- /ko -->
						<div data-bind="
												attr: {
													style: 'padding: 5px;border: 1px solid;margin-bottom: 5px;' +
													($data == $parent.selected() ? 'border-color: red;background: #eee;' : '') +
													($parents[1].disabledGroupings[$parentContext.$index()].indexOf($data) >= 0 ? 'opacity: 0.5;' : '')
												},
												click: function () {$parents[1].selectVariant($data, $parentContext.$index())}
											">
							<div data-bind="text: $data.join(', ')"></div>
							<div data-bind="text: $parents[1].flightsById[$data[0]].legs[$parentContext.$index()].depAirp.IATA + ' - ' + $parents[1].flightsById[$data[0]].legs[$parentContext.$index()].arrAirp.IATA"></div>
							<div data-bind="text: $parents[1].flightsById[$data[0]].legs[$parentContext.$index()].depDateTime.getISOTime() + ' - ' + $parents[1].flightsById[$data[0]].legs[$parentContext.$index()].arrDateTime.getISOTime()"></div>
						</div>
					</div>
					<!-- ko if: $index() == ($parent.legGroupings.length - 1) -->
					<div data-bind="
							attr: {style: 'border: 1px solid #fff;display: inline-block;vertical-align: top; padding: 5px;'},
							foreach: flights">
						<!-- ko if: $index() == 0 -->
						<div>buy block</div>
						<!-- /ko -->
						<div data-bind="
								attr: {style: 'padding: 5px;border: 1px solid;margin-bottom: 5px;' + ($data == $parent.selected() ? 'border-color: red;background: #eee;' : '')}
							">
							&nbsp;
							<br/>
								<span class="new-ui-pseudoLink" data-bind="
									click: function () {if ($data != $parent.selected()) {$parents[1].selectVariant($data, $parentContext.$index())}else{$parents[3].bookFlight($parents[1].selectedFlightsIds());}},
									text: 'Buy for '+$parents[1].flightsById[$data[0]].getTotalPrice().normalizedAmount()+' '+$parents[1].flightsById[$data[0]].getTotalPrice().currency()
								"></span>
							<br/>
							&nbsp;
						</div>
					</div>
					<!-- /ko -->
				</div>
			</div>
			<!-- /ko -->
			<!-- /ko -->
		</div>
		<!-- /ko -->
	</script>
</div>
